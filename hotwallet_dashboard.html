<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ í•«ì›”ë › í† í° ëŒ€ì‹œë³´ë“œ</title>

    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">

    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Streamlit ìŠ¤íƒ€ì¼ - ë‹¤í¬ í…Œë§ˆ */
            --bg-primary: #0e1117;
            --bg-secondary: #1a1d24;
            --bg-tertiary: #262b36;
            --text-primary: #fafafa;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-blue: #4da6ff;
            --accent-green: #00d26a;
            --accent-red: #ff4b4b;
            --accent-yellow: #ffc107;
            --accent-purple: #9467bd;
            --border-color: #333842;
            --highlight-yellow: rgba(255, 193, 7, 0.15);
            --highlight-yellow-border: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-status {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        .status-dot.offline { background: var(--accent-red); animation: none; }
        .status-dot.loading { background: var(--accent-yellow); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .card-content {
            padding: 20px;
        }

        /* Input Section */
        .input-section {
            display: grid;
            grid-template-columns: 200px 1fr auto;
            gap: 12px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .input-hint {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 400;
            margin-left: 8px;
        }

        select, input[type="text"] {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        input[type="text"]::placeholder {
            color: var(--text-muted);
        }

        /* Buttons - Streamlit ìŠ¤íƒ€ì¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .btn-primary {
            background: #ff4b4b;
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #ff3333;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-blue);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-icon {
            font-size: 1.1rem;
        }

        /* Market Data Section */
        .market-data {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .market-data {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .market-item {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }

        .market-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .market-value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
        }

        .market-change {
            font-size: 0.85rem;
            margin-top: 4px;
        }

        .market-change.positive { color: var(--accent-green); }
        .market-change.negative { color: var(--accent-red); }

        .price-source {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(63, 185, 80, 0.15);
            color: var(--accent-green);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 4px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.8rem;
            line-height: 1.3;
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            padding: 6px 8px;
        }

        /* ìˆ«ì ì—´ ê³ ì • ë„ˆë¹„ ë° ìš°ì¸¡ ì •ë ¬ */
        td.balance-cell, td.usd-value, td.withdrawal-amount {
            text-align: right;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.78rem;
            white-space: nowrap;
        }

        th:nth-child(3), th:nth-child(4), th:nth-child(5) {
            text-align: right;
        }

        th:hover {
            color: var(--accent-blue);
        }

        th.sorted {
            color: var(--accent-blue);
        }

        tr:hover {
            background: rgba(88, 166, 255, 0.05);
        }

        tr.highlight {
            background: var(--highlight-yellow) !important;
            border-left: 4px solid var(--highlight-yellow-border) !important;
        }

        /* ì¶œê¸ˆ ì‹œê°„ ê°•ì¡° - 1ì‹œê°„ ì´ë‚´ */
        .time-recent {
            background: rgba(255, 193, 7, 0.3) !important;
            color: #ffc107 !important;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* ì¶œê¸ˆ ì‹œê°„ ê°•ì¡° - 5ë¶„ ì´ë‚´ (ì¶”ê°€ ê°•ì¡°) */
        .time-very-recent {
            background: rgba(255, 75, 75, 0.4) !important;
            color: #ff6b6b !important;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            animation: blink-time 1s ease-in-out infinite;
        }

        @keyframes blink-time {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ë‹¬ëŸ¬ ì”ê³  ê°•ì¡° - $50ë§Œ ì´ìƒ */
        .usd-high {
            background: rgba(0, 210, 106, 0.25) !important;
            color: #00d26a !important;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* ë‹¬ëŸ¬ ì”ê³  ê°•ì¡° - $100ë§Œ ì´ìƒ (ì¶”ê°€ ê°•ì¡°) */
        .usd-very-high {
            background: rgba(0, 210, 106, 0.45) !important;
            color: #00ff88 !important;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            box-shadow: 0 0 8px rgba(0, 210, 106, 0.3);
        }

        .wallet-name {
            font-weight: 500;
        }

        .wallet-name .badge {
            display: inline-block;
            background: #ffc107;
            color: #000;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: 700;
        }

        /* í† í° ì •ë³´ í—¤ë” */
        .token-info-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .token-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .token-info-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .token-info-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        .token-contract-copy {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-blue);
            cursor: pointer;
            padding: 4px 10px;
            background: rgba(77, 166, 255, 0.1);
            border-radius: 4px;
            transition: all 0.2s;
        }

        .token-contract-copy:hover {
            background: rgba(77, 166, 255, 0.2);
        }

        .token-contract-copy.copied {
            background: rgba(0, 210, 106, 0.2);
            color: var(--accent-green);
        }

        /* DEX ê²€ìƒ‰ ì²´í¬ë°•ìŠ¤ */
        .dex-search-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .dex-search-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-blue);
            cursor: pointer;
        }

        .dex-search-option label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .dex-search-option .hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-left: 8px;
        }

        /* ì •ë ¬ ë¼ë””ì˜¤ ë²„íŠ¼ */
        .sort-options {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
        }

        .sort-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .sort-options label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-primary);
            cursor: pointer;
        }

        .sort-options input[type="radio"] {
            accent-color: var(--accent-red);
        }

        /* DEX ì •ë³´ ë°•ìŠ¤ */
        .info-box {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 8px 14px;
            margin: 8px 0;
            font-size: 0.85rem;
        }

        .info-box.loading {
            color: var(--accent-blue);
        }

        .info-box.success {
            color: var(--accent-green);
        }

        /* ìš”ì•½ í†µê³„ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .stats-grid .stat-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stats-grid .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-grid .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .stats-grid .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
        }

        .wallet-address {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .balance-cell {
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
        }

        .usd-value {
            color: var(--accent-green);
            font-weight: 600;
        }

        .withdrawal-info {
            font-size: 0.85rem;
        }

        .withdrawal-amount {
            color: var(--accent-yellow);
            font-weight: 500;
        }

        .withdrawal-time,
        .withdrawal-time-left {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .explorer-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .explorer-link:hover {
            text-decoration: underline;
        }

        /* ë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .copy-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px 4px;
            font-size: 0.75rem;
            border-radius: 4px;
            transition: all 0.2s;
            margin-left: 4px;
        }

        .copy-btn:hover {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
        }

        .copy-btn.copied {
            color: var(--accent-green);
        }

        /* í´ë¦­í•˜ì—¬ ë³µì‚¬ ê°€ëŠ¥í•œ ì…€ */
        .clickable-copy {
            cursor: pointer;
            transition: all 0.2s;
        }

        .clickable-copy:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .clickable-copy.copied {
            color: var(--accent-green) !important;
        }

        /* í´ë¦­í•˜ì—¬ íƒìƒ‰ê¸° ì—´ê¸° */
        .clickable-link {
            cursor: pointer;
            transition: all 0.2s;
        }

        .clickable-link:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        /* í† í° í‹°ì»¤ ë³µì‚¬ ì˜ì—­ */
        .token-ticker-display {
            display: none;
            align-items: center;
            gap: 8px;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: 'Roboto Mono', monospace;
        }

        .token-ticker-display.show {
            display: inline-flex;
        }

        .ticker-label {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .ticker-value {
            color: var(--accent-blue);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ticker-value:hover {
            text-decoration: underline;
        }

        .ticker-value.copied {
            color: var(--accent-green);
        }

        .copy-hint {
            font-size: 0.65rem;
            color: var(--text-muted);
            opacity: 0.7;
        }

        .wallet-type {
            font-weight: 600;
            font-size: 0.8rem;
        }

        .wallet-type.cex {
            color: var(--accent-blue);
        }

        .wallet-type.dex {
            color: var(--accent-purple);
        }

        /* Summary */
        .summary-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 12px;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .summary-value {
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
        }

        /* Settings Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .token-select-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        .token-select-item:hover {
            background: var(--bg-tertiary);
        }

        .token-select-item:last-child {
            border-bottom: none;
        }

        .api-key-input {
            margin-bottom: 16px;
        }

        .api-key-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .api-key-input input {
            width: 100%;
        }

        /* Loading - Streamlit ìŠ¤íƒ€ì¼ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 30px 50px;
            z-index: 999;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            flex-direction: column;
            gap: 16px;
        }

        .loading-overlay.active {
            display: block;
        }

        .loading-text {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .loading-detail {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* Progress Bar - Streamlit ìŠ¤íƒ€ì¼ */
        .progress-bar {
            width: 280px;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #ff4b4b;
            transition: width 0.3s;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        /* Sort icons */
        .sort-icon {
            margin-left: 4px;
            opacity: 0.5;
        }

        th.sorted .sort-icon {
            opacity: 1;
        }

        /* Token Info */
        .token-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 16px;
        }

        .token-symbol {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .token-contract {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 6px;
        }

        /* Refresh button */
        .refresh-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .refresh-btn.spinning .btn-icon {
            animation: spin 1s linear infinite;
        }

        /* Settings button */
        .settings-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        .settings-btn:hover {
            border-color: var(--accent-blue);
        }

        /* Auto refresh indicator */
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .auto-refresh-toggle {
            position: relative;
            width: 40px;
            height: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .auto-refresh-toggle.active {
            background: var(--accent-green);
        }

        .auto-refresh-toggle::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .auto-refresh-toggle.active::after {
            left: 22px;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 900px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-title h1 {
                font-size: 1.2rem;
            }

            .card {
                padding: 12px;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start !important;
            }

            .card-title {
                flex-wrap: wrap;
                gap: 4px;
            }

            .card-title span:last-child {
                display: none; /* ê¸´ ì„¤ëª… ìˆ¨ê¹€ */
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .stat-box {
                padding: 12px;
            }

            .stat-value {
                font-size: 1rem;
            }

            .market-data-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .balance-summary {
                grid-template-columns: 1fr;
            }

            .search-form {
                flex-direction: column;
            }

            .chain-select, .token-input {
                width: 100%;
            }

            .search-btn {
                width: 100%;
            }

            .sort-options {
                flex-wrap: wrap;
                justify-content: flex-start;
            }

            /* í…Œì´ë¸” ëª¨ë°”ì¼ ìµœì í™” */
            table {
                font-size: 0.75rem;
                min-width: 700px;
            }

            th, td {
                padding: 6px 4px;
            }

            .wallet-address {
                max-width: 80px;
            }

            .copy-btn {
                font-size: 0.65rem;
                padding: 1px 2px;
            }

            /* ë¯¸ë‹ˆ ê°€ê²© í‘œì‹œ */
            #miniPriceDisplay {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header-title h1 {
                font-size: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .market-data-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.7rem;
                min-width: 600px;
            }

            .stat-value {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <span style="font-size: 2rem;">ğŸ”¥</span>
                <h1>í•«ì›”ë › í† í° ëŒ€ì‹œë³´ë“œ</h1>
            </div>
            <div class="header-status">
                <div class="status-item">
                    <span class="status-dot" id="wsStatus"></span>
                    <span id="wsStatusText">ì—°ê²° ëŒ€ê¸°</span>
                </div>
                <div class="status-item">
                    <span>ë§ˆì§€ë§‰ ê°±ì‹ :</span>
                    <span id="lastUpdate">-</span>
                </div>
            </div>
        </header>

        <!-- Input Section -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ”</span>
                    <span>í† í° ì¡°íšŒ</span>
                </div>
            </div>
            <div class="card-content">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">ì²´ì¸ ì„ íƒ</label>
                        <select id="chainSelect">
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="BSC">BNB Chain (BSC)</option>
                            <option value="ARB">Arbitrum (ARB)</option>
                            <option value="OP">Optimism (OP)</option>
                            <option value="BASE">Base (BASE)</option>
                            <option value="AVAX">Avalanche (AVAX)</option>
                            <option value="POL">Polygon (POL)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">í† í° ê²€ìƒ‰ <span class="input-hint">ğŸ’¡ í‹°ì»¤ ë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ</span></label>
                        <input type="text" id="tokenAddress" placeholder="ì˜ˆ: PEPE, ZKP, 0x...">
                    </div>
                    <button class="btn btn-primary" onclick="startSearch()" id="searchBtn">
                        <span class="btn-icon">ğŸš€</span>
                        <span>ì¡°íšŒ ì‹œì‘</span>
                    </button>
                </div>
                <div class="dex-search-option">
                    <input type="checkbox" id="includeDex" checked>
                    <label for="includeDex">DEX ìœ ë™ì„± í’€ í¬í•¨</label>
                    <span class="hint">(Uniswap, SushiSwap ë“±)</span>
                </div>
            </div>
        </div>

        <!-- Results Section (Hidden by default) -->
        <div id="resultsSection" style="display: none;">
            <!-- Token Info Header -->
            <div class="token-info-header" id="tokenInfoHeader">
                <div class="token-info-item">
                    <span class="token-info-label">ì²´ì¸:</span>
                    <span class="token-info-value" id="tokenChainDisplay">ETH</span>
                </div>
                <div class="token-info-item">
                    <span class="token-info-label">í† í° ì´ë¦„:</span>
                    <span class="token-info-value" id="tokenNameDisplay">-</span>
                </div>
                <div class="token-info-item">
                    <span class="token-info-label">ì‹¬ë³¼:</span>
                    <span class="token-info-value" id="tokenSymbolDisplay">-</span>
                </div>
                <div class="token-info-item">
                    <span class="token-info-label">ì»¨íŠ¸ë™íŠ¸:</span>
                    <span class="token-contract-copy" id="tokenContractCopy" onclick="copyContract()" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">-</span>
                </div>
            </div>

            <!-- Token Info -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>ğŸ’¹</span>
                        <span>ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°</span>
                        <span style="margin-left: 10px; font-size: 0.9rem; color: var(--accent-yellow);" id="tokenSymbol"></span>
                        <span style="font-size: 0.75rem; color: var(--text-muted); font-family: 'Roboto Mono', monospace;" id="tokenContractDisplay"></span>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div class="auto-refresh" title="30ì´ˆë§ˆë‹¤ ì”ê³ /ì¶œê¸ˆ ìë™ ê°±ì‹ ">
                            <span>ìë™ê°±ì‹ </span>
                            <div class="auto-refresh-toggle active" id="autoRefreshToggle" onclick="toggleAutoRefresh()"></div>
                        </div>
                        <button class="refresh-btn" onclick="refreshData()" id="refreshBtn" title="ì”ê³ /ì¶œê¸ˆ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨">
                            <span class="btn-icon">ğŸ”„</span>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="market-data">
                        <div class="market-item">
                            <div class="market-label">í˜„ì¬ê°€</div>
                            <div class="market-value" id="currentPrice">$0.00</div>
                            <div class="market-change" id="priceChange">-</div>
                        </div>
                        <div class="market-item">
                            <div class="market-label">ì‹œê°€ì´ì•¡ (MC)</div>
                            <div class="market-value" id="marketCap">-</div>
                        </div>
                        <div class="market-item">
                            <div class="market-label">ì™„ì „í¬ì„ê°€ì¹˜ (FDV)</div>
                            <div class="market-value" id="fdv">-</div>
                        </div>
                        <div class="market-item">
                            <div class="market-label">24ì‹œê°„ ê±°ë˜ëŸ‰</div>
                            <div class="market-value" id="volume24h">-</div>
                        </div>
                    </div>
                    <div class="price-source">
                        <span style="margin-right: 10px;">ğŸ“Š ë°ì´í„° ì¶œì²˜: </span>
                        <span class="live-indicator" id="priceSource">
                            <span class="status-dot"></span>
                            <span>CoinGecko</span>
                        </span>
                    </div>

                    <!-- ì •ë ¬ ê¸°ì¤€ -->
                    <div class="sort-options">
                        <span class="sort-label">ì •ë ¬ ê¸°ì¤€</span>
                        <label>
                            <input type="radio" name="sortOption" value="balance" onchange="sortTable('balance', true)">
                            ì”ê³  ë§ì€ ìˆœ
                        </label>
                        <label>
                            <input type="radio" name="sortOption" value="usd" checked onchange="sortTable('usd', true)">
                            ë‹¬ëŸ¬ ê°€ì¹˜ ë†’ì€ ìˆœ
                        </label>
                        <label>
                            <input type="radio" name="sortOption" value="withdrawalTime" onchange="sortTable('withdrawalTime', true)">
                            ìµœê·¼ ì¶œê¸ˆ ìˆœ
                        </label>
                    </div>

                    <!-- DEX ì •ë³´ -->
                    <div class="info-box loading" id="dexLoadingBox">
                        ğŸ” DEX ìœ ë™ì„± í’€ ì¡°íšŒ ì¤‘...
                    </div>
                    <div class="info-box success" id="dexVolumeBox" style="display: none;">
                        ğŸ“Š DEX 24ì‹œê°„ ê±°ë˜ëŸ‰: <span id="dexVolume">$0.00</span>
                    </div>

                    <!-- í†µê³„ ê·¸ë¦¬ë“œ -->
                    <div class="stats-grid">
                        <div class="stat-group">
                            <div class="stat-label">CEX ì´ ì”ê³ </div>
                            <div class="stat-value" id="cexTotalBalance">0</div>
                            <div class="stat-label">CEX ë‹¬ëŸ¬ ê°€ì¹˜</div>
                            <div class="stat-value" style="color: var(--accent-green);" id="cexTotalUsd">$0.00</div>
                        </div>
                        <div class="stat-group">
                            <div class="stat-label">DEX ì´ ì”ê³ </div>
                            <div class="stat-value" id="dexTotalBalance">0</div>
                            <div class="stat-label">DEX ë‹¬ëŸ¬ ê°€ì¹˜</div>
                            <div class="stat-value" style="color: var(--accent-green);" id="dexTotalUsd">$0.00</div>
                        </div>
                        <div class="stat-group">
                            <div class="stat-label">ì „ì²´ ì´ ì”ê³ </div>
                            <div class="stat-value" id="grandTotalBalance">0</div>
                            <div class="stat-label">ì „ì²´ ë‹¬ëŸ¬ ê°€ì¹˜</div>
                            <div class="stat-value" style="color: var(--accent-green);" id="grandTotalUsd">$0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wallet Table -->
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                    <div class="card-title">
                        <span>ğŸ“Š</span>
                        <span>ì§€ê°‘ë³„ ì”ê³  & ì¶œê¸ˆ í˜„í™©</span>
                        <span style="font-size: 0.85rem; color: var(--text-muted);" id="walletCount">(0ê°œ ì§€ê°‘)</span>
                        <span style="font-size: 0.75rem; color: var(--text-muted); margin-left: 12px;">â„¹ï¸ ìµœê·¼ì¶œê¸ˆ: ê° ì§€ê°‘ë³„ ìµœê·¼ ì…ì¶œê¸ˆ ë‚´ì—­ 30ê±´ ì¡°íšŒ í›„ ì—…ë°ì´íŠ¸ (30ê±´ ë‚´ ì¶œê¸ˆ ì—†ìœ¼ë©´ ë¯¸í‘œì‹œ)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                        <!-- í† í° í‹°ì»¤/ì»¨íŠ¸ë™íŠ¸ ë³µì‚¬ -->
                        <div id="tokenTickerDisplay" class="token-ticker-display">
                            <span class="ticker-label">í† í°:</span>
                            <span id="tickerSymbol" class="ticker-value" onclick="copyToClipboard(this.textContent, this)" title="í´ë¦­í•˜ì—¬ í‹°ì»¤ ë³µì‚¬">-</span>
                            <span class="ticker-label">|</span>
                            <span id="tickerContract" class="ticker-value" onclick="copyToClipboard(currentToken, this)" title="í´ë¦­í•˜ì—¬ ì»¨íŠ¸ë™íŠ¸ ë³µì‚¬" style="font-size: 0.75rem;">-</span>
                            <span class="copy-hint">(í´ë¦­ì‹œ ë³µì‚¬)</span>
                        </div>
                        <!-- ì‹¤ì‹œê°„ ê°€ê²© ë¯¸ë‹ˆ í‘œì‹œ -->
                        <div id="miniPriceDisplay" style="display: none; align-items: center; gap: 8px; background: var(--bg-tertiary); padding: 6px 12px; border-radius: 8px;">
                            <span id="miniTokenSymbol" style="font-weight: 600; color: var(--accent-blue);"></span>
                            <span id="miniPrice" style="font-family: 'Roboto Mono', monospace; font-weight: 500;"></span>
                            <span id="miniPriceChange" style="font-size: 0.8rem;"></span>
                            <span id="miniPriceSource" style="font-size: 0.7rem; color: var(--text-muted); margin-left: 4px;"></span>
                        </div>
                        <div id="withdrawalStatus" style="font-size: 0.8rem; color: var(--text-secondary); display: none;">
                            <span class="loading-spinner" style="width: 12px; height: 12px; border-width: 2px; margin-right: 6px;"></span>
                            <span id="withdrawalStatusText">ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì¤‘...</span>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortTable('withdrawalTime')">ì¶œê¸ˆì‹œê°„ <span class="sort-icon">â†•</span></th>
                                <th onclick="sortTable('name')">ì§€ê°‘ì´ë¦„ <span class="sort-icon">â†•</span></th>
                                <th>ì£¼ì†Œ</th>
                                <th onclick="sortTable('balance')">ì”ê³  <span class="sort-icon">â†•</span></th>
                                <th onclick="sortTable('usd')">ë‹¬ëŸ¬í™˜ì‚° <span class="sort-icon">â†•</span></th>
                                <th onclick="sortTable('withdrawal')">ìµœê·¼ì¶œê¸ˆ($) <span class="sort-icon">â†•</span></th>
                                <th>ì¶œê¸ˆëŒ€ìƒ</th>
                                <th onclick="sortTable('withdrawalTime')">ì¶œê¸ˆì‹œê°„ <span class="sort-icon">â†•</span></th>
                                <th>íƒìƒ‰ê¸°</th>
                                <th>íƒ€ì…</th>
                            </tr>
                        </thead>
                        <tbody id="walletTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
                <div class="summary-section">
                    <div class="summary-item">
                        <span class="summary-label">ì´ ì”ê³ :</span>
                        <span class="summary-value" id="totalBalance">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì´ ë‹¬ëŸ¬ê°€ì¹˜:</span>
                        <span class="summary-value usd-value" id="totalUsd">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ê°±ì‹  ì‹œê°„:</span>
                        <span class="summary-value" id="updateTime">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="card">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”¥</div>
                <h3>í•«ì›”ë › í† í° ëŒ€ì‹œë³´ë“œ</h3>
                <p style="margin-top: 12px; color: var(--text-secondary);">
                    ê±°ë˜ì†Œ í•«ì›”ë ›ì˜ í† í° ë³´ìœ ëŸ‰ê³¼ ì¶œê¸ˆ í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
                </p>
                <div style="margin-top: 24px; text-align: left; max-width: 520px; margin-left: auto; margin-right: auto; background: var(--bg-tertiary); padding: 20px; border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">ğŸ“Œ ì‚¬ìš© ë°©ë²•</div>
                    <div style="font-size: 0.9rem; line-height: 1.8; color: var(--text-secondary);">
                        <div>1. ì²´ì¸ ì„ íƒ (ETH, BSC, ARB ë“±)</div>
                        <div>2. í† í° ì´ë¦„(PEPE) ë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ(0x...) ì…ë ¥</div>
                        <div>3. ì¡°íšŒ ì‹œì‘ ë²„íŠ¼ í´ë¦­</div>
                    </div>
                </div>
                <div style="margin-top: 20px; font-size: 0.8rem; color: var(--text-muted);">
                    ì§€ì› ì²´ì¸: Ethereum Â· BSC Â· Arbitrum Â· Optimism Â· Base Â· Avalanche Â· Polygon
                </div>
            </div>
        </div>
    </div>

    <!-- Token Select Modal -->
    <div class="modal-overlay" id="tokenSelectModal" onclick="if(event.target===this) closeTokenSelectModal()">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3>ğŸ” í† í° ì„ íƒ</h3>
                <button class="modal-close" onclick="closeTokenSelectModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="padding: 12px 16px; background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color); font-size: 0.85rem; color: var(--text-secondary);">
                    ì—¬ëŸ¬ í† í°ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” í† í°ì„ ì„ íƒí•˜ì„¸ìš”.
                </div>
                <div id="tokenSelectList" style="max-height: 400px; overflow-y: auto;">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>
    </div>


    <!-- Loading Overlay - Streamlit ìŠ¤íƒ€ì¼ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-text" id="loadingText">ë¡œë”© ì¤‘...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="loading-detail" id="loadingDetail"></div>
    </div>

    <script>
        // ===== ì„¤ì • ë°ì´í„° =====
        const CONFIG = {
            chains: {
                ETH: {
                    chainId: 1,
                    name: "Ethereum",
                    explorer: "https://etherscan.io",
                    explorerApi: "https://api.etherscan.io/v2/api",
                    rpcUrls: [
                        "https://eth.drpc.org",
                        "https://rpc.ankr.com/eth",
                        "https://ethereum-rpc.publicnode.com",
                        "https://1rpc.io/eth"
                    ],
                    coingeckoId: "ethereum",
                    wallets: {
                        "ë°”ë‚¸16ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0xdfd5293d8e347dfe59e90efd55b2956a1343963d",
                        "ë°”ë‚¸15ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x21a31ee1afc51d94c2efccaa2092ad1028285549",
                        "ë°”ë‚¸14ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x28c6c06298d514db089934071355e5743bf21d60",
                        "ë°”ë‚¸18ë²ˆí•«": "0x9696f59e4d72e237be84ffd425dcad154bf96976",
                        "ë°”ë‚¸51ë²ˆì§€ê°‘(ì½œë“œì¶”ì •)": "0x8894e0a0c962cb723c1976a4421c95949be2d4e3",
                        "ë°”ë‚¸93ë²ˆì§€ê°‘(ì½œë“œì¶”ì •)": "0x98adef6f2ac8572ec48965509d69a8dd5e8bba9d",
                        "ë°”ë‚¸withdraw7ì§€ê°‘": "0xe2fc31f816a9b94326492132018c3aecc4a93ae1",
                        "ë°”ë‚¸ì½œë“œ1": "0x0a367f918340d47d36b21c93e9a2b6853cc9d6f0",
                        "ë°”ë‚¸ì½œë“œ2": "0x6b5c22a67b44faac1eddd6ae1b284b2606f62071",
                        "ë°”ë‚¸28ë²ˆì§€ê°‘(ì½œë“œì¶”ì •)": "0x5a52E96BAcdaBb82fd05763E25335261B270Efcb",
                        "ë°”ë‚¸20ë²ˆì§€ê°‘(ì½œë“œì¶”ì •)": "0xF977814e90dA44bFA03b6295A0616a897441aceC",
                        "ê²Œì´íŠ¸1ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
                        "ê²Œì´íŠ¸ì½œë“œì¶”ì •": "0xD13C536e71698e189329e9583BE8b67817E045b0",
                        "ë°”ë¹—í•«(ê±°ì˜ë©”ì¸)": "0xf89d7b9c864f589bbf53a82105107622b35eaa40",
                        "ë°”ë¹—í•«2": "0xA31231E727Ca53Ff95f0D00a06C645110c4aB647",
                        "ë°”ë¹—í•«3": "0xad85405cbb1476825b78a021fa9e543bf7937549",
                        "ë°”ë¹—í•«4": "0x6522B7F9d481eCEB96557F44753a4b893F837E90",
                        "ë°”ë¹—í•«173(ê±°ì˜ë©”ì¸)": "0xf42aac93ab142090db9fdc0bc86aab73cb36f173",
                        "ì½”ë² 10ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
                        "ë¹—ê²Ÿ3ë²ˆí•«": "0x97b9D2102A9a65A26E1EE82D59e42d1B73B68689",
                        "ë¹—ê²Ÿ5ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x5bdf85216ec1e38d6458c870992a69e38e03f7ef",
                        "ë¹—ê²Ÿ4ë²ˆí•«": "0x0639556f03714a74a5feeaf5736a4a64ff70d206",
                        "ë¹—ê²Ÿ6ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
                        "ì˜¤ì¼í•«(ë©”ì¸ì¶”ì •)": "0x91d40e4818f4d4c57b4578d9eca6afc92ac8debe",
                        "ì˜¤ì¼146ì§€ê°‘": "0x4a4aaa0155237881fbd5c34bfae16e985a7b068d",
                        "ì˜¤ì¼ì½œë“œ": "0xdce83237fbf279c4522e7cac4b10428e2b8694da",
                        "ë©•ì‹œ16ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x9642b23ed1e01df1092b92641051881a322f5d4e",
                        "ì¿ ì½”í•«": "0xd91efec7e42f80156d1d9f660a69847188950747",
                        "ì¿ ì½”20ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x58edf78281334335effa23101bbe3371b6a36a51",
                        "ì½”ë¹—8ë²ˆí•«": "0xf0bc8fddb1f358cef470d63f96ae65b1d7914953",
                        "ì½”ì¸ì›1ë²ˆí•«": "0x167a9333bf582556f35bd4d16a7e80e191aa6476",
                        "í›„ì˜¤ë¹„48ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0xa03400e098f4421b34a3a44a1b4e571419517687",
                        "í¬ë‹·12ë²ˆí•«(ë©”ì¸ì¶”ì •)": "0x46340b20830761efd32832a74d7169b29feb9758",
                        "í¬ë‹·21ë²ˆí•«": "0x5b71d5fd6bb118665582dd87922bf3b9de6c75f9",
                        "ë¹™í•«": "0x065AC3d33FEC104FBa9f2f4D674AfAA7c4EBcF43",
                        "í”Œë¦½í•«": "0xd49417f37cED33aBA35DDAbf208D5bFcD87b4eBe",
                        "ì½”ìºí•«": "0xFE6D9AF579dEcCeBfC2d8D366C3D667adB696b32",
                        "ë¹„íŠ¸ë§ˆíŠ¸16ë²ˆí•«": "0x2982bB64bcd07Ac3315C32Cb2BB7e5E8a2De7d67",
                        "í•´ì‹œí‚¤2ë²ˆí•«": "0xcBEA7739929cc6A2B4e46A1F6D26841D8d668b9E",
                        "ë¹„íŠ¸íŒŒì´ë„¥ìŠ¤í•«": "0x77134cbC06cB00b66F4c7e623D5fdBF6777635EC",
                        "ë¹„íŠ¸ë£¨í•«": "0x6cc8dCbCA746a6E4Fdefb98E1d0DF903b107fd21",
                        "í¬ë¼ì¼„7ë²ˆí•«": "0x89e51fA8CA5D66cd220bAed62ED01e8951aa7c40",
                        "í¬ë¼ì¼„28ë²ˆí•«": "0x5c5F75B6FbA2903ADf66C7bDdCeA99B4CcE44a8A",
                        "í˜ë©•ìŠ¤1ë²ˆí•«": "0xdb861e302ef7b7578a448e951aede06302936c28",
                        "ì–´ì„¼ë±ìŠ¤6ë²ˆí•«": "0x983873529f95132BD1812A3B52c98Fb271d2f679",
                        "ì œë¯¸ë‹ˆ4ë²ˆí•«": "0x5f65f7b609678448494de4c87521cdf6cef1e932",
                        "ì½”ì¸exí•«": "0x20145c5e27408b5c1cf2239d0115ee3bbc27cbd7",
                        "ê³ íŒìŠ¤í•«": "0xe3031c1bfaa7825813c562cbdcc69d96fcad2087",
                        "woox2ë²ˆí•«": "0x63DFE4e34A3bFC00eB0220786238a7C6cEF8Ffc4"
                    }
                },
                BSC: {
                    chainId: 56,
                    name: "BNB Chain",
                    explorer: "https://bscscan.com",
                    explorerApi: "https://api.bscscan.com/api",
                    rpcUrls: [
                        "https://bsc-rpc.publicnode.com",
                        "https://rpc.ankr.com/bsc",
                        "https://bsc.drpc.org",
                        "https://1rpc.io/bnb"
                    ],
                    coingeckoId: "binance-smart-chain",
                    wallets: {
                        "ë°”ë‚¸12ë²ˆí•«": "0x515b72ed8a97f42c568d6a143232775018f133c8",
                        "ë°”ë‚¸10ë²ˆí•«": "0xEB2d2F1b8c558a40207669291Fda468E50c8A0bB",
                        "ë°”ë‚¸20ë²ˆí•«(ì½œë“œì¶”ì •)": "0xF977814e90dA44bFA03b6295A0616a897441aceC",
                        "ë°”ë‚¸16ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0xa180fe01b906a1be37be6c534a3300785b20d947",
                        "ë°”ë‚¸7ë²ˆí•«": "0xe2fc31F816A9b94326492132018C3aEcC4a93aE1",
                        "ë°”ë‚¸51ë²ˆí•«": "0x8894E0a0c962CB723c1976a4421c95949bE2D4E3",
                        "ë°”ë¹—í•«(ê±°ì˜ë©”ì¸)": "0xf89d7b9c864f589bbf53a82105107622b35eaa40",
                        "ë°”ë¹—í•«2": "0xc3121c4ca7402922e025e62e9bb4d5b244303878",
                        "ê²Œì´íŠ¸í•«(ê±°ì˜ë©”ì¸)": "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
                        "ë©•ì‹œ13ë²ˆí•«": "0x4982085c9e2f89f2ecb8131eca71afad896e89cb",
                        "ë¹„íŠ¸ë£¨í•«": "0x868f027a5e3bd1cd29606a6681c3ddb7d3dd9b67",
                        "ë¹—ê²Ÿ3ë²ˆí•«": "0x97b9d2102a9a65a26e1ee82d59e42d1b73b68689",
                        "ë¹—ê²Ÿ4ë²ˆí•«": "0x0639556f03714a74a5feeaf5736a4a64ff70d206",
                        "ë¹—ê²Ÿ6ë²ˆí•«": "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
                        "ì¿ ì½”2ë²ˆí•«": "0x53f78a071d04224b8e254e243fffc6d9f2f3fa23",
                        "í”Œë¦½í•«": "0xCD47f02B261426Ab734Be9271156327327407E43",
                        "ì½”ìºí•«": "0xFE6D9AF579dEcCeBfC2d8D366C3D667adB696b32",
                        "ì˜¤ì¼í•«": "0xf5988713400DA6fC8A58EC9515e2b0DF9B40B115",
                        "í›„ì˜¤ë¹„72ë²ˆí•«": "0xdd3CB5c974601BC3974d908Ea4A86020f9999E0c",
                        "ë¹™í•«": "0x065AC3d33FEC104FBa9f2f4D674AfAA7c4EBcF43",
                        "ë¹„íŠ¸ë§ˆíŠ¸í•«": "0xa23EF2319bA4C933eBfDbA80c332664A6Cb13F1A",
                        "í•´ì‹œí‚¤í•«": "0x6A276a58C5194eF196B58442f627Dba070CB37BF",
                        "í˜ë©•ìŠ¤í•«": "0xDB861E302EF7B7578A448e951AedE06302936c28",
                        "ì–´ì„¼ë±ìŠ¤í•«": "0x983873529f95132BD1812A3B52c98Fb271d2f679",
                        "ì½”ì¸exí•«": "0x32e3e876aa0C1732ed9Efcf9d8615De7afaEF59f",
                        "woox í•«": "0x63DFE4e34A3bFC00eB0220786238a7C6cEF8Ffc4"
                    }
                },
                ARB: {
                    chainId: 42161,
                    name: "Arbitrum",
                    explorer: "https://arbiscan.io",
                    explorerApi: "https://api.etherscan.io/v2/api",
                    rpcUrls: [
                        "https://arbitrum-one-rpc.publicnode.com",
                        "https://rpc.ankr.com/arbitrum",
                        "https://arb1.arbitrum.io/rpc",
                        "https://1rpc.io/arb"
                    ],
                    coingeckoId: "arbitrum-one",
                    wallets: {
                        "ë°”ë‚¸89ë²ˆí•«": "0x3931dab967c3e2dbb492fe12460a66d0fe4cc857",
                        "ë°”ë‚¸54ë²ˆí•«": "0xb38e8c17e38363af6ebdcb3dae12e0243582891d",
                        "ë°”ë‚¸í•«3": "0x25681ab599b4e2ceea31f8b498052c53fc2d74db",
                        "ë¹—ê²Ÿ5ë²ˆí•«(ê±°ì˜ë©”ì¸)": "0x5bdf85216ec1e38d6458c870992a69e38e03f7ef",
                        "ê²Œì´íŠ¸1ë²ˆí•«": "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
                        "ë°”ë¹—í•«(ê±°ì˜ë©”ì¸)": "0xf89d7b9c864f589bbf53a82105107622b35eaa40",
                        "í”Œë¦½6ë²ˆí•«": "0xa9b686EE77EfC18e7a08c48FA823CAA0cfDd754E",
                        "ì˜¤ì¼í•«": "0xAfEE421482FAEa92292ED3ffE29371742542AD72",
                        "ì¿ ì½”24ë²ˆí•«": "0x03E6FA590CAdcf15A38e86158E9b3D06FF3399Ba"
                    }
                },
                OP: {
                    chainId: 10,
                    name: "Optimism",
                    explorer: "https://optimistic.etherscan.io",
                    explorerApi: "https://api.etherscan.io/v2/api",
                    rpcUrls: [
                        "https://optimism-rpc.publicnode.com",
                        "https://rpc.ankr.com/optimism",
                        "https://mainnet.optimism.io",
                        "https://1rpc.io/op"
                    ],
                    coingeckoId: "optimistic-ethereum",
                    wallets: {
                        "ë°”ë‚¸55ë²ˆí•«": "0xacd03d601e5bb1b275bb94076ff46ed9d753435a",
                        "ë°”ë¹—í•«(ê±°ì˜ë©”ì¸)": "0xf89d7b9c864f589bbf53a82105107622b35eaa40",
                        "ê²Œì´íŠ¸1ë²ˆí•«": "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
                        "ë©•ì‹œí•«7ë²ˆí•«": "0xDF90C9B995a3b10A5b8570a47101e6c6a29eb945",
                        "ë¹—ê²Ÿ6ë²ˆí•«": "0x1AB4973a48dc892Cd9971ECE8e01DcC7688f8F23",
                        "ì˜¤ì¼í•«": "0xB5216CB558Cb018583bED009EE25cA73Eb27bB1d",
                        "ì¿ ì½”26ë²ˆí•«": "0xa3f45e619cE3AAe2Fa5f8244439a66B203b78bCc",
                        "ì½”ë² 11ë²ˆí•«": "0xC8373EDFaD6d5C5f600b6b2507F78431C5271fF5"
                    }
                },
                BASE: {
                    chainId: 8453,
                    name: "Base",
                    explorer: "https://basescan.org",
                    explorerApi: "https://api.etherscan.io/v2/api",
                    rpcUrls: [
                        "https://base-rpc.publicnode.com",
                        "https://rpc.ankr.com/base",
                        "https://mainnet.base.org",
                        "https://1rpc.io/base"
                    ],
                    coingeckoId: "base",
                    wallets: {
                        "ë°”ë‚¸73ë²ˆí•«": "0x3304e22ddaa22bcdc5fca2269b418046ae7b566a",
                        "ë°”ë¹—6ë²ˆí•«": "0xbaed383ede0e5d9d72430661f3285daa77e9439f",
                        "ê²Œì´íŠ¸1ë²ˆí•«": "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
                        "ë©•ì‹œ15ë²ˆ": "0x4e3ae00E8323558fA5Cac04b152238924AA31B60",
                        "ë¹—ê²Ÿ3ë²ˆí•«": "0x97b9D2102A9a65A26E1EE82D59e42d1B73B68689",
                        "ì˜¤ì¼í•«": "0xc8802feab2fafb48b7d1ade77e197002c210f391"
                    }
                },
                AVAX: {
                    chainId: 43114,
                    name: "Avalanche",
                    explorer: "https://snowtrace.io",
                    explorerApi: "https://api.routescan.io/v2/network/mainnet/evm/43114/etherscan/api",
                    rpcUrls: [
                        "https://avalanche-c-chain-rpc.publicnode.com",
                        "https://rpc.ankr.com/avalanche",
                        "https://avax.meowrpc.com",
                        "https://1rpc.io/avax/c"
                    ],
                    coingeckoId: "avalanche",
                    wallets: {
                        "ë°”ë‚¸1ë²ˆí•«": "0x6d8be5cdf0d7dee1f04e25fd70b001ae3b907824",
                        "ë°”ë‚¸í•«": "0xcddc5d0ebeb71a08fff26909aa6c0d4e256b4fe1",
                        "ë°”ë‚¸í•«2": "0x3bce63c6c9abf7a47f52c9a3a7950867700b0158",
                        "ì½”ë² 7ë²ˆí•«": "0xe1a0ddeb9b5b55e489977b438764e60e314e917c",
                        "ì½”ë² 1ë²ˆí•«": "0x3dd87411a3754deea8cc52c4cf57e2fc254924cc",
                        "ì˜¤ì¼í•«": "0xC94bb9b883Ab642C1C3Ed07af4E36523e7DaF1Fe",
                        "ì¿ ì½”32ë²ˆí•«": "0x4E75e27e5Aa74F0c7A9D4897dC10EF651f3A3995",
                        "í› ë¹„í•«": "0xa77ff0e1C52f58363a53282624C7BaA5fA91687D",
                        "ë¹—ê²Ÿ6ë²ˆí•«": "0x1AB4973a48dc892Cd9971ECE8e01DcC7688f8F23"
                    }
                },
                POL: {
                    chainId: 137,
                    name: "Polygon",
                    explorer: "https://polygonscan.com",
                    explorerApi: "https://api.etherscan.io/v2/api",
                    rpcUrls: [
                        "https://polygon-bor-rpc.publicnode.com",
                        "https://rpc.ankr.com/polygon",
                        "https://polygon.drpc.org",
                        "https://1rpc.io/matic"
                    ],
                    coingeckoId: "polygon-pos",
                    wallets: {
                        "ë°”ë¹—í•«(ê±°ì˜ë©”ì¸)": "0xf89d7b9c864f589bbf53a82105107622b35eaa40",
                        "ë©•ì‹œí•«": "0x51E3D44172868Acc60D68ca99591Ce4230bc75E0",
                        "ë¹—ê²Ÿ6ë²ˆí•«": "0x1AB4973a48dc892Cd9971ECE8e01DcC7688f8F23",
                        "ë¹—ê²Ÿ4ë²ˆí•«": "0x0639556F03714A74a5fEEaF5736a4A64fF70D206",
                        "ì¿ ì½”í•«": "0x9AC5637d295FEA4f51E086C329d791cC157B1C84",
                        "ì˜¤ì¼í•«": "0x343d752bB710c5575E417edB3F9FA06241A4749A"
                    }
                }
            },
            refreshInterval: 30000, // 30ì´ˆ
            withdrawalOffset: 30 // ìµœê·¼ 30ê±´
        };

        // ===== ì „ì—­ ìƒíƒœ =====
        let currentChain = 'ETH';
        let currentToken = '';
        let currentPrice = 0;
        let tokenDecimals = 18;
        let tokenSymbol = '';
        let tokenName = '';  // í† í° ì „ì²´ ì´ë¦„ (ê²€ìƒ‰ì—ì„œ ê°€ì ¸ì˜´)
        let currentCoinGeckoId = '';  // CoinGecko coin ID (markets APIìš©)
        let walletData = [];
        let autoRefreshEnabled = true;
        let refreshTimer = null;
        let websockets = new Map();
        let circulatingSupply = 0;
        let isWithdrawalFetching = false;  // ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì¤‘ í”Œë˜ê·¸
        let withdrawalCache = new Map();   // ì¶œê¸ˆ ë‚´ì—­ ìºì‹œ (address -> withdrawal)
        let failedAddresses = new Set();  // NOTOKìœ¼ë¡œ ì‹¤íŒ¨í•œ ì£¼ì†Œ (ë‹¤ìŒ ê°±ì‹  ë•Œ ìš°ì„  ì¬ì‹œë„)

        // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
        // ì‹œì´/FDV ë“± í° ê¸ˆì•¡ìš© (ì¶•ì•½í˜•: 1.23B, 45.6M)
        function formatNumber(num, decimals = 2) {
            if (num === null || num === undefined || isNaN(num)) return '-';
            if (num >= 1e9) return `${(num / 1e9).toFixed(decimals)}B`;
            if (num >= 1e6) return `${(num / 1e6).toFixed(decimals)}M`;
            if (num >= 1e3) return `${(num / 1e3).toFixed(decimals)}K`;
            return num.toFixed(decimals);
        }

        // ì‹œì´/FDV ë“±ìš© (ì¶•ì•½í˜•)
        function formatUsd(num) {
            if (num === null || num === undefined || isNaN(num)) return '-';
            return `$${formatNumber(num)}`;
        }

        // ì”ê³ ìš© (ì‰¼í‘œ í¬í•¨, ì†Œìˆ˜ì  4ìë¦¬) - ê¸°ì¡´ Streamlit ìŠ¤íƒ€ì¼
        function formatBalance(num) {
            if (num === null || num === undefined || isNaN(num)) return '0.0000';
            return num.toLocaleString('en-US', {
                minimumFractionDigits: 4,
                maximumFractionDigits: 4
            });
        }

        // ë‹¬ëŸ¬ í™˜ì‚°ìš© (ì‰¼í‘œ í¬í•¨, ì†Œìˆ˜ì  2ìë¦¬) - ê¸°ì¡´ Streamlit ìŠ¤íƒ€ì¼
        function formatUsdTable(num) {
            if (num === null || num === undefined || isNaN(num)) return '$0.00';
            return '$' + num.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatTimeAgo(timestamp) {
            if (!timestamp) return '-';
            const now = Date.now();
            const diff = (now - timestamp * 1000) / 1000;

            if (diff < 60) return `${Math.floor(diff)}ì´ˆ ì „`;
            if (diff < 3600) return `${Math.floor(diff / 60)}ë¶„ ì „`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}ì‹œê°„ ì „`;
            return `${Math.floor(diff / 86400)}ì¼ ì „`;
        }

        // ì¶œê¸ˆ ì‹œê°„ ê²½ê³¼(ë¶„) ê³„ì‚°
        function getMinutesAgo(timestamp) {
            if (!timestamp) return Infinity;
            const now = Date.now();
            const diff = (now - timestamp * 1000) / 1000;
            return diff / 60; // ë¶„ ë‹¨ìœ„
        }

        // ì¶œê¸ˆ ì‹œê°„ ê°•ì¡° í´ë˜ìŠ¤ ê²°ì •
        function getTimeHighlightClass(timestamp) {
            const minutes = getMinutesAgo(timestamp);
            if (minutes <= 5) return 'time-very-recent';  // 5ë¶„ ì´ë‚´ - ë¹¨ê°„ìƒ‰ ê¹œë¹¡ì„
            if (minutes <= 60) return 'time-recent';       // 1ì‹œê°„ ì´ë‚´ - ë…¸ë€ìƒ‰
            return '';
        }

        // ë‹¬ëŸ¬ ì”ê³  ê°•ì¡° í´ë˜ìŠ¤ ê²°ì •
        function getUsdHighlightClass(usdValue) {
            if (usdValue >= 1000000) return 'usd-very-high';  // $100ë§Œ ì´ìƒ
            if (usdValue >= 500000) return 'usd-high';        // $50ë§Œ ì´ìƒ
            return '';
        }

        function shortenAddress(addr) {
            if (!addr) return '-';
            return `${addr.slice(0, 10)}...${addr.slice(-6)}`;
        }

        // í´ë¦½ë³´ë“œ ë³µì‚¬ í•¨ìˆ˜
        async function copyToClipboard(text, element) {
            if (!text || text === '-') return;

            try {
                await navigator.clipboard.writeText(text);

                // ë³µì‚¬ ì„±ê³µ í”¼ë“œë°±
                if (element) {
                    element.classList.add('copied');

                    setTimeout(() => {
                        element.classList.remove('copied');
                    }, 1000);
                }

                console.log('ë³µì‚¬ë¨:', text);
            } catch (err) {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                // í´ë°±: êµ¬í˜• ë°©ì‹
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }

        function showLoading(text = 'ë¡œë”© ì¤‘...') {
            document.getElementById('loadingOverlay').classList.add('active');
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingDetail').textContent = '';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        let lastProgress = 0;
        function updateProgress(percent, detail = '', forceReset = false) {
            // ë¦¬ì…‹ì´ ì•„ë‹ˆë©´ í•­ìƒ ì•ìœ¼ë¡œë§Œ ì§„í–‰ (ë’¤ë¡œ ê°€ì§€ ì•ŠìŒ)
            if (forceReset) {
                lastProgress = percent;
            } else {
                lastProgress = Math.max(lastProgress, percent);
            }
            document.getElementById('progressFill').style.width = `${lastProgress}%`;
            if (detail) {
                document.getElementById('loadingDetail').textContent = detail;
            }
        }


        // ===== ì‹œì¥ ë°ì´í„° ì¡°íšŒ =====
        async function getMarketData(chain, tokenContract) {
            const chainConfig = CONFIG.chains[chain];
            const coingeckoChain = chainConfig.coingeckoId;

            // ë°©ë²• 1: coinIdê°€ ìˆìœ¼ë©´ markets API ì‚¬ìš© (ê°€ì¥ ì‹ ë¢°ì„± ë†’ìŒ - ì‹œì´ì¡°íšŒë´‡ ë°©ì‹)
            if (currentCoinGeckoId) {
                try {
                    const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${currentCoinGeckoId}&order=market_cap_desc&per_page=1&page=1&sparkline=false&price_change_percentage=24h`;
                    const res = await fetch(url);

                    if (res.ok) {
                        const data = await res.json();
                        if (data && data.length > 0) {
                            const coin = data[0];
                            return {
                                price: coin.current_price || 0,
                                marketCap: coin.market_cap || 0,
                                fdv: coin.fully_diluted_valuation || 0,
                                volume24h: coin.total_volume || 0,
                                priceChange24h: coin.price_change_percentage_24h || 0,
                                circulatingSupply: coin.circulating_supply || 0,
                                symbol: coin.symbol?.toUpperCase() || tokenSymbol || 'UNKNOWN'
                            };
                        }
                    }
                } catch (e) {
                    console.warn('CoinGecko markets API error, trying contract API:', e);
                }
            }

            // ë°©ë²• 2: contract API (coinIdê°€ ì—†ê±°ë‚˜ markets ì‹¤íŒ¨ ì‹œ)
            try {
                const url = `https://api.coingecko.com/api/v3/coins/${coingeckoChain}/contract/${tokenContract.toLowerCase()}`;
                const res = await fetch(url);

                if (res.ok) {
                    const data = await res.json();
                    const marketData = data.market_data || {};

                    // coinId ì €ì¥ (ë‹¤ìŒ ê°±ì‹  ì‹œ markets API ì‚¬ìš© ê°€ëŠ¥)
                    if (data.id && !currentCoinGeckoId) {
                        currentCoinGeckoId = data.id;
                    }

                    return {
                        price: marketData.current_price?.usd || 0,
                        marketCap: marketData.market_cap?.usd || 0,
                        fdv: marketData.fully_diluted_valuation?.usd || 0,
                        volume24h: marketData.total_volume?.usd || 0,
                        priceChange24h: marketData.price_change_percentage_24h || 0,
                        circulatingSupply: marketData.circulating_supply || 0,
                        symbol: data.symbol?.toUpperCase() || 'UNKNOWN'
                    };
                }
            } catch (e) {
                console.warn('CoinGecko contract API error:', e);
            }

            // ë°©ë²• 3: simple price API (ìµœí›„ì˜ ìˆ˜ë‹¨)
            try {
                const url = `https://api.coingecko.com/api/v3/simple/token_price/${chainConfig.coingeckoId}`;
                const params = new URLSearchParams({
                    contract_addresses: tokenContract.toLowerCase(),
                    vs_currencies: 'usd',
                    include_market_cap: 'true',
                    include_24hr_vol: 'true',
                    include_24hr_change: 'true'
                });

                const res = await fetch(`${url}?${params}`);
                if (res.ok) {
                    const data = await res.json();
                    const tokenData = data[tokenContract.toLowerCase()] || {};

                    return {
                        price: tokenData.usd || 0,
                        marketCap: tokenData.usd_market_cap || 0,
                        fdv: 0,  // simple APIëŠ” FDV ë¯¸ì œê³µ
                        volume24h: tokenData.usd_24h_vol || 0,
                        priceChange24h: tokenData.usd_24h_change || 0,
                        circulatingSupply: 0,
                        symbol: tokenSymbol || 'TOKEN'
                    };
                }
            } catch (e) {
                console.warn('CoinGecko simple API error:', e);
            }

            // ëª¨ë“  API ì‹¤íŒ¨ ì‹œ
            return { price: 0, marketCap: 0, fdv: 0, volume24h: 0, priceChange24h: 0, circulatingSupply: 0, symbol: tokenSymbol || 'UNKNOWN' };
        }

        // ===== RPC Provider ê°€ì ¸ì˜¤ê¸° =====
        const providerCache = new Map();

        async function getProvider(chain) {
            // ìºì‹œëœ provider ë°˜í™˜
            if (providerCache.has(chain)) {
                return providerCache.get(chain);
            }

            const chainConfig = CONFIG.chains[chain];
            if (!chainConfig || !chainConfig.rpcUrls) {
                return null;
            }

            // RPC URL ìˆœíšŒí•˜ë©° ì‘ë™í•˜ëŠ” ê²ƒ ì°¾ê¸°
            for (const rpcUrl of chainConfig.rpcUrls) {
                try {
                    const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                    // ì—°ê²° í…ŒìŠ¤íŠ¸
                    await provider.getBlockNumber();
                    // ì„±ê³µì‹œ ìºì‹œí•˜ê³  ë°˜í™˜
                    providerCache.set(chain, provider);
                    return provider;
                } catch (e) {
                    continue;
                }
            }

            return null;
        }

        // ===== í† í° ì •ë³´ ì¡°íšŒ (ethers.js) =====
        async function getTokenInfo(chain, tokenContract) {
            const chainConfig = CONFIG.chains[chain];

            for (const rpcUrl of chainConfig.rpcUrls) {
                try {
                    const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                    const abi = [
                        "function name() view returns (string)",
                        "function symbol() view returns (string)",
                        "function decimals() view returns (uint8)"
                    ];
                    const contract = new ethers.Contract(tokenContract, abi, provider);

                    const [name, symbol, decimals] = await Promise.all([
                        contract.name().catch(() => 'Unknown'),
                        contract.symbol().catch(() => 'UNKNOWN'),
                        contract.decimals().catch(() => 18)
                    ]);

                    return { name, symbol, decimals };
                } catch (e) {
                    continue;
                }
            }

            return { name: 'Unknown', symbol: 'UNKNOWN', decimals: 18 };
        }

        // ===== ì”ê³  ì¡°íšŒ =====
        async function getBalance(chain, wallet, tokenContract) {
            const chainConfig = CONFIG.chains[chain];

            for (const rpcUrl of chainConfig.rpcUrls) {
                try {
                    const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                    const abi = ["function balanceOf(address) view returns (uint256)"];
                    const contract = new ethers.Contract(tokenContract, abi, provider);

                    const balance = await contract.balanceOf(wallet);
                    return parseFloat(ethers.utils.formatUnits(balance, tokenDecimals));
                } catch (e) {
                    continue;
                }
            }

            return 0;
        }

        // ===== ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ =====
        // Transfer ì´ë²¤íŠ¸ ì‹œê·¸ë‹ˆì²˜ (ERC20)
        const TRANSFER_TOPIC = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef';

        // ë¸”ë¡ íƒ€ì„ìŠ¤íƒ¬í”„ ìºì‹œ
        const blockTimestampCache = new Map();

        async function getBlockTimestamp(provider, blockNumber) {
            if (blockTimestampCache.has(blockNumber)) {
                return blockTimestampCache.get(blockNumber);
            }
            try {
                const block = await provider.getBlock(blockNumber);
                if (block) {
                    blockTimestampCache.set(blockNumber, block.timestamp);
                    return block.timestamp;
                }
            } catch (e) {
                console.warn('ë¸”ë¡ íƒ€ì„ìŠ¤íƒ¬í”„ ì¡°íšŒ ì‹¤íŒ¨:', e);
            }
            return Math.floor(Date.now() / 1000);
        }

        async function getLastWithdrawal(chain, wallet, tokenContract) {
            const chainConfig = CONFIG.chains[chain];

            try {
                // RPC Provider ê°€ì ¸ì˜¤ê¸°
                const provider = await getProvider(chain);
                if (!provider) {
                    console.warn(`[ì¶œê¸ˆì¡°íšŒ] ${chain} Provider ì—†ìŒ`);
                    return { error: 'NO_PROVIDER' };
                }

                // í˜„ì¬ ë¸”ë¡ ë²ˆí˜¸
                const currentBlock = await provider.getBlockNumber();

                // ìµœê·¼ 9500 ë¸”ë¡ì—ì„œ ê²€ìƒ‰ (ë¬´ë£Œ RPC ì œí•œ: 10000 ë¸”ë¡)
                // ETH ì•½ 32ì‹œê°„, BSC ì•½ 8ì‹œê°„
                const fromBlock = Math.max(0, currentBlock - 9500);

                // ì§€ê°‘ ì£¼ì†Œë¥¼ 32ë°”ì´íŠ¸ë¡œ íŒ¨ë”© (topic1 = from ì£¼ì†Œ)
                const paddedWallet = '0x' + wallet.slice(2).toLowerCase().padStart(64, '0');

                // Transfer ì´ë²¤íŠ¸ ë¡œê·¸ ì¡°íšŒ (from = walletì¸ ì¶œê¸ˆë§Œ)
                const logs = await provider.getLogs({
                    address: tokenContract,
                    topics: [
                        TRANSFER_TOPIC,      // topic0: Transfer ì´ë²¤íŠ¸
                        paddedWallet,        // topic1: from (ì¶œê¸ˆ ì£¼ì†Œ)
                        null                 // topic2: to (ëª¨ë“  ìˆ˜ì‹ ì)
                    ],
                    fromBlock: fromBlock,
                    toBlock: 'latest'
                });

                if (logs.length === 0) {
                    return null;  // ì¶œê¸ˆ ë‚´ì—­ ì—†ìŒ
                }

                // ê°€ì¥ ìµœê·¼ ë¡œê·¸ (ë§ˆì§€ë§‰ ìš”ì†Œ)
                const latestLog = logs[logs.length - 1];

                // ê¸ˆì•¡ íŒŒì‹± (data í•„ë“œì—ì„œ)
                const amount = parseFloat(ethers.BigNumber.from(latestLog.data).toString()) / Math.pow(10, tokenDecimals);

                // to ì£¼ì†Œ ì¶”ì¶œ (topic2ì—ì„œ)
                const toAddress = '0x' + latestLog.topics[2].slice(26);

                // ë¸”ë¡ íƒ€ì„ìŠ¤íƒ¬í”„ ì¡°íšŒ
                const timestamp = await getBlockTimestamp(provider, latestLog.blockNumber);

                return {
                    amount,
                    to: toAddress,
                    timestamp: timestamp,
                    hash: latestLog.transactionHash
                };

            } catch (e) {
                console.warn(`[ì¶œê¸ˆì¡°íšŒ ì‹¤íŒ¨] ${wallet.slice(0,10)}... ì—ëŸ¬: ${e.message}`);
                return { error: e.message };
            }
        }


        // ===== ëª¨ë“  ì§€ê°‘ ë°ì´í„° ì¡°íšŒ =====
        async function fetchAllWalletData(skipWithdrawal = false, skipSort = false) {
            const chainConfig = CONFIG.chains[currentChain];
            const wallets = chainConfig.wallets;
            const walletEntries = Object.entries(wallets);

            // ê¸°ì¡´ DEX ë°ì´í„° ë³´ì¡´
            const existingDexData = walletData.filter(w => w.type === 'DEX');
            walletData = [];
            const total = walletEntries.length;

            // ë³‘ë ¬ë¡œ ì”ê³  ì¡°íšŒ (ë¹ ë¦„)
            const balancePromises = walletEntries.map(async ([name, address]) => {
                const balance = await getBalance(currentChain, address, currentToken);
                return { name, address, balance };
            });

            const balanceResults = await Promise.allSettled(balancePromises);

            // ì”ê³  ê²°ê³¼ë¡œ walletData ì´ˆê¸°í™” (ì¶œê¸ˆ ë‚´ì—­ì€ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ null)
            walletEntries.forEach(([name, address], index) => {
                const result = balanceResults[index];
                const balance = result.status === 'fulfilled' ? result.value.balance : 0;
                const usdValue = balance * currentPrice;

                walletData.push({
                    name,
                    address,
                    balance,
                    usdValue,
                    withdrawal: withdrawalCache.get(address) || null,  // ìºì‹œì—ì„œ ê°€ì ¸ì˜´
                    isMain: name.includes('(ê±°ì˜ë©”ì¸)') || name.includes('(ë©”ì¸ì¶”ì •)'),
                    type: 'CEX'
                });
            });

            updateProgress(50, `ì”ê³  ì¡°íšŒ ì™„ë£Œ: ${total}ê°œ`);

            // ê¸°ì¡´ DEX ë°ì´í„° ë‹¤ì‹œ ì¶”ê°€ (USD ê°€ì¹˜ ì—…ë°ì´íŠ¸)
            existingDexData.forEach(dex => {
                // ê°€ê²© ë³€ë™ì— ë”°ë¼ USD ê°€ì¹˜ ì¬ê³„ì‚°
                if (currentPrice > 0 && dex.balance > 0) {
                    dex.usdValue = dex.balance * currentPrice;
                }
                walletData.push(dex);
            });

            // ì”ê³  ë¨¼ì € í…Œì´ë¸”ì— í‘œì‹œ (ë¡œë”© í•´ì œ)
            // skipSort=trueë©´ ì •ë ¬ ìŠ¤í‚µ (DEX ë°ì´í„° ì¶”ê°€ í›„ í•œ ë²ˆì— ì •ë ¬)
            if (!skipSort) {
                sortTable('usd', true);
                hideLoading();
            }

            // ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ (skipWithdrawal=trueë©´ ìŠ¤í‚µ - ìë™ê°±ì‹  ì‹œ)
            if (!skipWithdrawal) {
                // ì¶œê¸ˆ ë‚´ì—­ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆœì°¨ ì¡°íšŒ (í…Œì´ë¸” ìœ ì§€í•˜ë©´ì„œ ê°œë³„ í–‰ ì—…ë°ì´íŠ¸)
                fetchWithdrawalsInBackground(walletEntries, total);
            }

            return walletData;
        }

        // ì¶œê¸ˆ ë‚´ì—­ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateWithdrawalStatus(text, show = true) {
            const statusEl = document.getElementById('withdrawalStatus');
            const textEl = document.getElementById('withdrawalStatusText');
            if (statusEl && textEl) {
                statusEl.style.display = show ? 'flex' : 'none';
                textEl.textContent = text;
            }
        }

        // ì¶œê¸ˆ ë‚´ì—­ ë°±ê·¸ë¼ìš´ë“œ ì¡°íšŒ
        // ì¶œê¸ˆ ë‚´ì—­ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ë¹„êµ
        function isWithdrawalChanged(oldWithdrawal, newWithdrawal) {
            // ë‘˜ ë‹¤ nullì´ë©´ ë³€ê²½ ì—†ìŒ
            if (!oldWithdrawal && !newWithdrawal) return false;
            // í•˜ë‚˜ë§Œ nullì´ë©´ ë³€ê²½ë¨
            if (!oldWithdrawal || !newWithdrawal) return true;
            // ì—ëŸ¬ ìƒíƒœëŠ” ë¬´ì‹œ
            if (oldWithdrawal.error || newWithdrawal.error) return false;
            // ê¸ˆì•¡, ëŒ€ìƒ, í•´ì‹œê°€ ë‹¤ë¥´ë©´ ë³€ê²½ë¨
            return oldWithdrawal.amount !== newWithdrawal.amount ||
                   oldWithdrawal.to !== newWithdrawal.to ||
                   oldWithdrawal.hash !== newWithdrawal.hash;
        }

        async function fetchWithdrawalsInBackground(walletEntries, total, incrementalUpdate = false) {
            isWithdrawalFetching = true;  // ì¡°íšŒ ì‹œì‘

            const modeText = incrementalUpdate ? 'ì¦ë¶„ ê°±ì‹ ' : 'ì „ì²´ ì¡°íšŒ';

            // RPC ë°©ì‹ì€ rate limitì´ ëŠìŠ¨í•¨ - 5ê°œì”© ë³‘ë ¬ ì²˜ë¦¬
            const batchSize = 5;
            const delay = 200;

            // ì¦ë¶„ ê°±ì‹  ëª¨ë“œì—ì„œ ì´ì „ì— ì‹¤íŒ¨í•œ ì£¼ì†Œ ìš°ì„  ì²˜ë¦¬
            let priorityEntries = [];
            let normalEntries = walletEntries;

            if (incrementalUpdate && failedAddresses.size > 0) {
                priorityEntries = walletEntries.filter(([_, addr]) => failedAddresses.has(addr));
                normalEntries = walletEntries.filter(([_, addr]) => !failedAddresses.has(addr));
            }

            // ìš°ì„  ì²˜ë¦¬í•  ì£¼ì†Œì™€ ì¼ë°˜ ì£¼ì†Œ í•©ì¹˜ê¸° (ìš°ì„  ì£¼ì†Œ ë¨¼ì €)
            const orderedEntries = [...priorityEntries, ...normalEntries];


            let completed = 0;
            let updatedCount = 0;  // ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ëœ ê°œìˆ˜ (ì¦ë¶„ ëª¨ë“œìš©)
            const failedWallets = [];  // ì´ë²ˆ ì‚¬ì´í´ì—ì„œ ì‹¤íŒ¨í•œ ì§€ê°‘ ì¶”ì 
            const newFailedAddresses = new Set();  // ìƒˆë¡œìš´ ì‹¤íŒ¨ ì£¼ì†Œ ëª©ë¡

            for (let i = 0; i < orderedEntries.length; i += batchSize) {
                const batch = orderedEntries.slice(i, i + batchSize);

                // ì§„í–‰ ìƒí™© í‘œì‹œ (ìƒë‹¨ + í…Œì´ë¸” í—¤ë”)
                const statusText = incrementalUpdate
                    ? `ì¶œê¸ˆ ê°±ì‹  ì¤‘... ${Math.min(i + batchSize, total)}/${total}`
                    : `ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì¤‘... ${Math.min(i + batchSize, total)}/${total}`;
                document.getElementById('lastUpdate').textContent = statusText;
                updateWithdrawalStatus(statusText);

                // ë°°ì¹˜ ë³‘ë ¬ ì¡°íšŒ
                const promises = batch.map(async ([name, address]) => {
                    const withdrawal = await getLastWithdrawal(currentChain, address, currentToken);
                    return { name, address, withdrawal };
                });

                const results = await Promise.allSettled(promises);

                // ê²°ê³¼ ì²˜ë¦¬
                for (const result of results) {
                    if (result.status === 'fulfilled') {
                        const { name, address, withdrawal } = result.value;

                        // NOTOK ì‘ë‹µì´ë©´ ì‹¤íŒ¨ ëª©ë¡ì— ì¶”ê°€ (ë‚˜ì¤‘ì— ì¬ì‹œë„)
                        if (withdrawal && withdrawal.error === 'NOTOK') {
                            failedWallets.push([name, address]);
                            newFailedAddresses.add(address);
                        } else {
                            // ì„±ê³µ - ì‹¤íŒ¨ ëª©ë¡ì—ì„œ ì œê±°
                            failedAddresses.delete(address);

                            // ì¦ë¶„ ì—…ë°ì´íŠ¸ ëª¨ë“œ: ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                            const oldWithdrawal = withdrawalCache.get(address);
                            const hasChanged = isWithdrawalChanged(oldWithdrawal, withdrawal);

                            if (!incrementalUpdate || hasChanged) {
                                // ìºì‹œì— ì €ì¥
                                withdrawalCache.set(address, withdrawal);

                                // walletDataì—ì„œ í•´ë‹¹ ì§€ê°‘ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
                                const walletIndex = walletData.findIndex(w => w.address === address);
                                if (walletIndex !== -1) {
                                    walletData[walletIndex].withdrawal = withdrawal;
                                    updateSingleWalletRow(address, withdrawal);
                                }

                                if (incrementalUpdate && hasChanged) {
                                    updatedCount++;
                                }
                            }
                        }
                    }
                    completed++;
                }

                // Rate limit ë°©ì§€
                if (i + batchSize < orderedEntries.length) {
                    await new Promise(r => setTimeout(r, delay));
                }
            }

            // ì‹¤íŒ¨í•œ ì§€ê°‘ ì¬ì‹œë„ (1ê°œì”© ìˆœì°¨, ê¸´ ë”œë ˆì´)
            if (failedWallets.length > 0) {
                const retryText = `ì¬ì‹œë„ ì¤‘... 0/${failedWallets.length}`;
                document.getElementById('lastUpdate').textContent = retryText;
                updateWithdrawalStatus(retryText);

                for (let i = 0; i < failedWallets.length; i++) {
                    const [name, address] = failedWallets[i];

                    await new Promise(r => setTimeout(r, 2000));  // 2ì´ˆ ëŒ€ê¸°

                    const retryProgress = `ì¬ì‹œë„ ì¤‘... ${i + 1}/${failedWallets.length}`;
                    document.getElementById('lastUpdate').textContent = retryProgress;
                    updateWithdrawalStatus(retryProgress);

                    const withdrawal = await getLastWithdrawal(currentChain, address, currentToken);

                    if (!withdrawal || withdrawal.error !== 'NOTOK') {
                        // ì„±ê³µ - ì‹¤íŒ¨ ëª©ë¡ì—ì„œ ì œê±°
                        newFailedAddresses.delete(address);
                        failedAddresses.delete(address);

                        const oldWithdrawal = withdrawalCache.get(address);
                        const hasChanged = isWithdrawalChanged(oldWithdrawal, withdrawal);

                        if (!incrementalUpdate || hasChanged) {
                            withdrawalCache.set(address, withdrawal);
                            const walletIndex = walletData.findIndex(w => w.address === address);
                            if (walletIndex !== -1) {
                                walletData[walletIndex].withdrawal = withdrawal;
                                updateSingleWalletRow(address, withdrawal);
                            }

                            if (incrementalUpdate && hasChanged) {
                                updatedCount++;
                            }
                        }
                    } else {
                        // ì¬ì‹œë„ë„ ì‹¤íŒ¨ - ë‹¤ìŒ ê°±ì‹  ë•Œ ìš°ì„  ì²˜ë¦¬
                        newFailedAddresses.add(address);
                    }
                }
            }

            // ì‹¤íŒ¨í•œ ì£¼ì†Œ ëª©ë¡ ì—…ë°ì´íŠ¸ (ë‹¤ìŒ ê°±ì‹  ë•Œ ìš°ì„  ì¬ì‹œë„)
            newFailedAddresses.forEach(addr => failedAddresses.add(addr));
            if (failedAddresses.size > 0) {
            }

            isWithdrawalFetching = false;  // ì¡°íšŒ ì™„ë£Œ

            // ì™„ë£Œ í›„ ìƒíƒœ í‘œì‹œ (í…Œì´ë¸” í—¤ë”ëŠ” ìˆ¨ê¹€)
            if (incrementalUpdate) {
            }
            document.getElementById('lastUpdate').textContent =
                `ë§ˆì§€ë§‰ ê°±ì‹ : ${new Date().toLocaleTimeString()}`;
            updateWithdrawalStatus('', false);  // ìˆ¨ê¹€
        }

        // ê°œë³„ ì§€ê°‘ í–‰ì˜ ì¶œê¸ˆ ë‚´ì—­ë§Œ ì—…ë°ì´íŠ¸
        function updateSingleWalletRow(address, withdrawal) {
            const tbody = document.getElementById('walletTableBody');
            const rows = tbody.querySelectorAll('tr');

            for (const row of rows) {
                // ì£¼ì†Œë¡œ í–‰ ì°¾ê¸° (íƒìƒ‰ê¸° ë§í¬ì—ì„œ ì£¼ì†Œ í™•ì¸)
                const explorerLink = row.querySelector('a[href*="address"]');
                if (explorerLink && explorerLink.href.toLowerCase().includes(address.toLowerCase())) {
                    // ì¶œê¸ˆ ê¸ˆì•¡ ì…€ (4ë²ˆì§¸)
                    const withdrawalCell = row.cells[3];
                    // ì¶œê¸ˆ ëŒ€ìƒ ì…€ (5ë²ˆì§¸)
                    const targetCell = row.cells[4];

                    if (withdrawal && !withdrawal.error) {
                        withdrawalCell.textContent = formatUsdTable(withdrawal.amount * currentPrice);
                        targetCell.innerHTML = `<span style="color: var(--text-secondary)">${shortenAddress(withdrawal.to)}</span>`;
                    } else if (withdrawal?.error) {
                        withdrawalCell.textContent = 'ERR';
                        targetCell.textContent = '-';
                    } else {
                        withdrawalCell.textContent = '-';
                        targetCell.textContent = '-';
                    }
                    break;
                }
            }
        }

        // ===== UI ì—…ë°ì´íŠ¸ =====
        function updateMarketUI(marketData) {
            // UNKNOWNì´ë©´ ì „ì—­ tokenSymbol ì‚¬ìš©
            const displaySymbol = (marketData.symbol && marketData.symbol !== 'UNKNOWN')
                ? marketData.symbol
                : (tokenSymbol || 'UNKNOWN');
            document.getElementById('tokenSymbol').textContent = displaySymbol;
            document.getElementById('tokenContractDisplay').textContent = shortenAddress(currentToken);

            const priceText = marketData.price < 1 ? `$${marketData.price.toFixed(6)}` : `$${marketData.price.toFixed(4)}`;
            document.getElementById('currentPrice').textContent = priceText;

            const changeEl = document.getElementById('priceChange');
            const change = marketData.priceChange24h;
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeEl.className = `market-change ${change >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('marketCap').textContent = formatUsd(marketData.marketCap);
            document.getElementById('fdv').textContent = formatUsd(marketData.fdv);
            document.getElementById('volume24h').textContent = formatUsd(marketData.volume24h);

            currentPrice = marketData.price;
            circulatingSupply = marketData.circulatingSupply;

            // ë¯¸ë‹ˆ ê°€ê²© í‘œì‹œ ì—…ë°ì´íŠ¸ (ì´ˆê¸°: CoinGecko)
            updateMiniPrice(marketData.symbol || tokenSymbol, priceText, change, 'CoinGecko');
        }

        // í…Œì´ë¸” í—¤ë”ì˜ ë¯¸ë‹ˆ ê°€ê²© í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateMiniPrice(symbol, priceText, change, source = '') {
            const miniDisplay = document.getElementById('miniPriceDisplay');
            if (!miniDisplay) return;

            miniDisplay.style.display = 'flex';
            document.getElementById('miniTokenSymbol').textContent = symbol;
            document.getElementById('miniPrice').textContent = priceText;

            const changeEl = document.getElementById('miniPriceChange');
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeEl.style.color = change >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            changeEl.title = '24ì‹œê°„ ë³€ë™ë¥ ';

            // ì¶œì²˜ í‘œì‹œ (24h ë³€ë™ë¥  í¬í•¨)
            const sourceEl = document.getElementById('miniPriceSource');
            if (sourceEl && source) {
                sourceEl.textContent = `(${source} Â· 24h)`;
            }
        }

        function updateWalletTable(forceRedraw = false) {
            const tbody = document.getElementById('walletTableBody');
            const chainConfig = CONFIG.chains[currentChain];
            const existingRows = tbody.querySelectorAll('tr');

            let totalBalance = 0;
            let totalUsd = 0;

            // ê¸°ì¡´ í–‰ì´ ìˆê³ , ì§€ê°‘ ìˆ˜ê°€ ê°™ìœ¼ë©´ ê°œë³„ ì…€ë§Œ ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ë°©ì§€)
            if (!forceRedraw && existingRows.length === walletData.length && existingRows.length > 0) {
                walletData.forEach((wallet, index) => {
                    totalBalance += wallet.balance;
                    totalUsd += wallet.usdValue;

                    const row = existingRows[index];
                    if (!row) return;

                    // ì”ê³  ì…€ ì—…ë°ì´íŠ¸
                    const balanceCell = row.querySelector('.balance-cell');
                    if (balanceCell) balanceCell.textContent = formatBalance(wallet.balance);

                    // USD ì…€ ì—…ë°ì´íŠ¸ + ê°•ì¡° í‘œì‹œ
                    const usdCell = row.querySelector('.usd-value');
                    if (usdCell) {
                        usdCell.textContent = formatUsdTable(wallet.usdValue);
                        // ê°•ì¡° í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
                        usdCell.classList.remove('usd-high', 'usd-very-high');
                        const usdClass = getUsdHighlightClass(wallet.usdValue);
                        if (usdClass) usdCell.classList.add(usdClass);
                    }

                    // ì¶œê¸ˆ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
                    const withdrawalCell = row.querySelector('.withdrawal-amount');
                    if (withdrawalCell) {
                        const withdrawalUsd = wallet.withdrawal && !wallet.withdrawal.error
                            ? formatUsdTable(wallet.withdrawal.amount * currentPrice)
                            : wallet.withdrawal?.error ? 'ERR' : '-';
                        withdrawalCell.textContent = withdrawalUsd;
                    }

                    // ì¶œê¸ˆ ëŒ€ìƒ ì—…ë°ì´íŠ¸
                    const targetCell = row.querySelector('.withdrawal-target');
                    if (targetCell) {
                        const withdrawalTo = wallet.withdrawal && wallet.withdrawal.to && !wallet.withdrawal.error
                            ? shortenAddress(wallet.withdrawal.to)
                            : '-';
                        targetCell.textContent = withdrawalTo;
                    }

                    // ì¶œê¸ˆ ì‹œê°„ ì—…ë°ì´íŠ¸ + ê°•ì¡° í‘œì‹œ
                    const timeCell = row.querySelector('.withdrawal-time');
                    const nameCell = row.querySelector('.wallet-name');
                    const isDex = wallet.type === 'DEX';
                    const timeClass = !isDex ? getTimeHighlightClass(wallet.withdrawal?.timestamp) : '';

                    if (timeCell) {
                        const withdrawalTime = wallet.withdrawal && wallet.withdrawal.timestamp && !wallet.withdrawal.error
                            ? formatTimeAgo(wallet.withdrawal.timestamp)
                            : '-';
                        timeCell.textContent = withdrawalTime;
                        // ê°•ì¡° í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
                        timeCell.classList.remove('time-recent', 'time-very-recent');
                        if (timeClass) timeCell.classList.add(timeClass);
                    }

                    // ì§€ê°‘ ì´ë¦„ì—ë„ ë™ì¼í•œ ê°•ì¡° í‘œì‹œ
                    if (nameCell) {
                        nameCell.classList.remove('time-recent', 'time-very-recent');
                        if (timeClass) nameCell.classList.add(timeClass);
                    }

                    // ì™¼ìª½ ì¶œê¸ˆì‹œê°„ ì…€ ì—…ë°ì´íŠ¸
                    const timeLeftCell = row.querySelector('.withdrawal-time-left');
                    if (timeLeftCell) {
                        const withdrawalTime = wallet.withdrawal && wallet.withdrawal.timestamp && !wallet.withdrawal.error
                            ? formatTimeAgo(wallet.withdrawal.timestamp)
                            : '-';
                        timeLeftCell.textContent = withdrawalTime;
                        timeLeftCell.classList.remove('time-recent', 'time-very-recent');
                        if (timeClass) timeLeftCell.classList.add(timeClass);
                    }
                });
            } else {
                // ìƒˆë¡œ ê·¸ë¦¬ê¸° (ì§€ê°‘ ìˆ˜ê°€ ë‹¤ë¥´ê±°ë‚˜ ê°•ì œ ìƒˆë¡œê³ ì¹¨)
                tbody.innerHTML = walletData.map(wallet => {
                    totalBalance += wallet.balance;
                    totalUsd += wallet.usdValue;

                    const isDex = wallet.type === 'DEX';

                    // ì¶œê¸ˆ ê¸ˆì•¡ (ë‹¬ëŸ¬) - DEXëŠ” ì¶œê¸ˆ ë‚´ì—­ ì—†ìŒ
                    const withdrawalUsd = isDex ? '-' : (wallet.withdrawal && !wallet.withdrawal.error
                        ? formatUsdTable(wallet.withdrawal.amount * currentPrice)
                        : wallet.withdrawal?.error ? 'ERR' : '-');

                    // ì¶œê¸ˆ ëŒ€ìƒ (ì£¼ì†Œ ì¶•ì•½)
                    const withdrawalTo = isDex ? '-' : (wallet.withdrawal && wallet.withdrawal.to && !wallet.withdrawal.error
                        ? shortenAddress(wallet.withdrawal.to)
                        : '-');

                    // ì¶œê¸ˆ ì‹œê°„
                    const withdrawalTime = isDex ? '-' : (wallet.withdrawal && wallet.withdrawal.timestamp && !wallet.withdrawal.error
                        ? formatTimeAgo(wallet.withdrawal.timestamp)
                        : '-');

                    // ê°•ì¡° í‘œì‹œ í´ë˜ìŠ¤
                    const timeHighlightClass = isDex ? '' : getTimeHighlightClass(wallet.withdrawal?.timestamp);
                    const usdHighlightClass = getUsdHighlightClass(wallet.usdValue);

                    // íƒìƒ‰ê¸° URL - DEXëŠ” í˜ì–´ ì£¼ì†Œë¡œ ë§í¬
                    const explorerUrl = isDex
                        ? `${chainConfig.explorer}/address/${wallet.address}`
                        : `${chainConfig.explorer}/token/${currentToken}?a=${wallet.address}`;

                    // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼
                    const typeClass = isDex ? 'dex' : 'cex';
                    const typeText = isDex ? 'DEX' : 'CEX';

                    // ì¶œê¸ˆ ëŒ€ìƒ ì „ì²´ ì£¼ì†Œ (ë³µì‚¬ìš©)
                    const withdrawalToFull = wallet.withdrawal && wallet.withdrawal.to && !wallet.withdrawal.error
                        ? wallet.withdrawal.to : '';

                    return `
                        <tr class="${wallet.isMain ? 'highlight' : ''}" data-address="${wallet.address}">
                            <td class="withdrawal-time-left ${timeHighlightClass}">${withdrawalTime}</td>
                            <td class="wallet-name ${timeHighlightClass}">
                                ${wallet.name.replace('(ê±°ì˜ë©”ì¸)', '').replace('(ë©”ì¸ì¶”ì •)', '').replace('(ì½œë“œì¶”ì •)', '')}
                                ${wallet.isMain ? '<span class="badge">ë©”ì¸ì¶”ì •</span>' : ''}
                            </td>
                            <td class="wallet-address clickable-link" onclick="window.open('${explorerUrl}', '_blank')" title="í´ë¦­í•˜ì—¬ íƒìƒ‰ê¸° ì—´ê¸°">
                                ${shortenAddress(wallet.address)}
                            </td>
                            <td class="balance-cell">${formatBalance(wallet.balance)}</td>
                            <td class="usd-value ${usdHighlightClass}">${formatUsdTable(wallet.usdValue)}</td>
                            <td class="withdrawal-amount">${withdrawalUsd}</td>
                            <td class="withdrawal-target ${withdrawalToFull ? 'clickable-link' : ''}" ${withdrawalToFull ? `onclick="window.open('${chainConfig.explorer}/token/${currentToken}?a=${withdrawalToFull}', '_blank')" title="í´ë¦­í•˜ì—¬ ì¶œê¸ˆëŒ€ìƒ íƒìƒ‰ê¸° ì—´ê¸°"` : ''}>
                                ${withdrawalTo}
                            </td>
                            <td class="withdrawal-time ${timeHighlightClass}">${withdrawalTime}</td>
                            <td>
                                <a href="${explorerUrl}" target="_blank" class="explorer-link" title="íƒìƒ‰ê¸°ì—ì„œ ë³´ê¸°">ğŸ” í™•ì¸</a>
                            </td>
                            <td class="wallet-type ${typeClass}">${typeText}</td>
                        </tr>
                    `;
                }).join('');
            }

            document.getElementById('walletCount').textContent = `(${walletData.length}ê°œ ì§€ê°‘)`;
            document.getElementById('totalBalance').textContent = formatBalance(totalBalance);
            document.getElementById('totalUsd').textContent = formatUsdTable(totalUsd);
            document.getElementById('updateTime').textContent = new Date().toLocaleTimeString('ko-KR');
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');

            // CEX/DEX í†µê³„ ì—…ë°ì´íŠ¸
            updateStats(totalBalance, totalUsd);
        }

        // DEX ë°ì´í„° ì €ì¥
        let dexData = {
            totalBalance: 0,
            totalUsd: 0,
            volume24h: 0,
            pools: []
        };

        // CEX/DEX í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(cexBalance, cexUsd) {
            // CEX í†µê³„
            document.getElementById('cexTotalBalance').textContent = formatLargeNumber(cexBalance);
            document.getElementById('cexTotalUsd').textContent = formatUsdFull(cexUsd);

            // DEX í†µê³„
            document.getElementById('dexTotalBalance').textContent = formatLargeNumber(dexData.totalBalance);
            document.getElementById('dexTotalUsd').textContent = formatUsdFull(dexData.totalUsd);

            // ì „ì²´ í†µê³„
            const grandBalance = cexBalance + dexData.totalBalance;
            const grandUsd = cexUsd + dexData.totalUsd;
            document.getElementById('grandTotalBalance').textContent = formatLargeNumber(grandBalance);
            document.getElementById('grandTotalUsd').textContent = formatUsdFull(grandUsd);
        }

        // DEX ìœ ë™ì„± í’€ ë°ì´í„°ë§Œ ì¡°íšŒ (UI ì—…ë°ì´íŠ¸ ì—†ì´ ë°ì´í„° ë°˜í™˜)
        async function fetchDexLiquidityData() {
            const chainConfig = CONFIG.chains[currentChain];

            const dexScreenerChainMap = {
                'ETH': 'ethereum',
                'BSC': 'bsc',
                'ARB': 'arbitrum',
                'OP': 'optimism',
                'BASE': 'base',
                'AVAX': 'avalanche',
                'POL': 'polygon'
            };

            const dexChain = dexScreenerChainMap[currentChain];
            if (!dexChain) return [];

            try {
                const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${currentToken}`);
                if (!response.ok) return [];

                const data = await response.json();
                const pairs = data.pairs || [];
                const chainPairs = pairs.filter(p => p.chainId === dexChain);

                if (chainPairs.length === 0) {
                    document.getElementById('dexLoadingBox').style.display = 'none';
                    document.getElementById('dexVolumeBox').style.display = 'block';
                    document.getElementById('dexVolumeBox').innerHTML = 'ğŸ“Š DEX ìœ ë™ì„± í’€: ë°œê²¬ëœ í’€ ì—†ìŒ';
                    return [];
                }

                const pools = [];
                let totalLiquidity = 0;
                let totalVolume24h = 0;

                chainPairs.forEach(pair => {
                    const liquidity = parseFloat(pair.liquidity?.usd || 0);
                    const volume = parseFloat(pair.volume?.h24 || 0);
                    const priceUsd = parseFloat(pair.priceUsd || 0);
                    const quoteSymbol = pair.quoteToken?.symbol || 'UNKNOWN';
                    const dexName = pair.dexId?.toUpperCase() || 'DEX';

                    totalLiquidity += liquidity;
                    totalVolume24h += volume;

                    // ê¸°ì¡´ ë´‡ê³¼ ë™ì¼í•œ ê³„ì‚°: (ìœ ë™ì„±ì˜ 50%) / ê°€ê²© = í† í° ìˆ˜ëŸ‰
                    const tokenLiquidityUsd = liquidity / 2;
                    const tokenBalance = priceUsd > 0 ? tokenLiquidityUsd / priceUsd : 0;


                    pools.push({
                        name: `ğŸŠ ${dexName} (${quoteSymbol} í˜ì–´)`,
                        address: pair.pairAddress,
                        balance: tokenBalance,
                        usdValue: tokenLiquidityUsd,
                        isMain: false,
                        withdrawal: null,
                        type: 'DEX'
                    });
                });

                // DEX í†µê³„ ì—…ë°ì´íŠ¸
                dexData = {
                    totalBalance: currentPrice > 0 ? (totalLiquidity / 2) / currentPrice : 0,
                    totalUsd: totalLiquidity / 2,
                    volume24h: totalVolume24h,
                    pools: pools
                };

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('dexLoadingBox').style.display = 'none';
                document.getElementById('dexVolumeBox').style.display = 'block';
                document.getElementById('dexVolumeBox').innerHTML = `
                    ğŸ“Š DEX 24ì‹œê°„ ê±°ë˜ëŸ‰: <span style="color: var(--accent-green);">${formatUsdFull(totalVolume24h)}</span>
                    &nbsp;|&nbsp; ì´ ìœ ë™ì„±: <span style="color: var(--accent-blue);">${formatUsdFull(totalLiquidity)}</span>
                    &nbsp;|&nbsp; í’€ ${chainPairs.length}ê°œ
                `;

                return pools;
            } catch (e) {
                console.error('[DEX] ì¡°íšŒ ì˜¤ë¥˜:', e);
                document.getElementById('dexLoadingBox').style.display = 'none';
                return [];
            }
        }

        // DEX ìœ ë™ì„± í’€ ì¡°íšŒ (ê¸°ì¡´ - UI ì—…ë°ì´íŠ¸ í¬í•¨, ë°±ê·¸ë¼ìš´ë“œìš©)
        async function fetchDexLiquidity() {
            const chainConfig = CONFIG.chains[currentChain];

            // DEX ë¡œë”© í‘œì‹œ
            document.getElementById('dexLoadingBox').style.display = 'block';
            document.getElementById('dexLoadingBox').textContent = 'ğŸ” DEX ìœ ë™ì„± í’€ ì¡°íšŒ ì¤‘...';
            document.getElementById('dexVolumeBox').style.display = 'none';

            // DEX ë°ì´í„° ì´ˆê¸°í™”
            dexData = {
                totalBalance: 0,
                totalUsd: 0,
                volume24h: 0,
                pools: []
            };

            try {
                // DexScreener APIë¡œ í† í° í’€ ì •ë³´ ì¡°íšŒ
                const dexScreenerChainMap = {
                    'ETH': 'ethereum',
                    'BSC': 'bsc',
                    'ARB': 'arbitrum',
                    'OP': 'optimism',
                    'BASE': 'base',
                    'AVAX': 'avalanche',
                    'POL': 'polygon'
                };

                const dexChain = dexScreenerChainMap[currentChain];
                if (!dexChain) {
                    throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì²´ì¸');
                }

                const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${currentToken}`);
                if (!response.ok) {
                    throw new Error('DexScreener API ì˜¤ë¥˜');
                }

                const data = await response.json();
                const pairs = data.pairs || [];


                // í˜„ì¬ ì²´ì¸ì˜ í’€ë§Œ í•„í„°ë§
                const chainPairs = pairs.filter(p => p.chainId === dexChain);

                if (pairs.length > 0 && chainPairs.length === 0) {
                }

                if (chainPairs.length === 0) {
                    document.getElementById('dexLoadingBox').style.display = 'none';
                    document.getElementById('dexVolumeBox').style.display = 'block';
                    document.getElementById('dexVolumeBox').innerHTML = 'ğŸ“Š DEX ìœ ë™ì„± í’€: ë°œê²¬ëœ í’€ ì—†ìŒ';
                    return;
                }

                // í’€ ì •ë³´ ì§‘ê³„
                let totalLiquidity = 0;
                let totalVolume24h = 0;

                chainPairs.forEach(pair => {
                    const liquidity = parseFloat(pair.liquidity?.usd || 0);
                    const volume = parseFloat(pair.volume?.h24 || 0);
                    const priceUsd = parseFloat(pair.priceUsd || 0);
                    const quoteSymbol = pair.quoteToken?.symbol || 'UNKNOWN';
                    const dexName = pair.dexId?.toUpperCase() || 'DEX';

                    totalLiquidity += liquidity;
                    totalVolume24h += volume;

                    // ê¸°ì¡´ ë´‡ê³¼ ë™ì¼í•œ ê³„ì‚°: (ìœ ë™ì„±ì˜ 50%) / ê°€ê²© = í† í° ìˆ˜ëŸ‰
                    const tokenLiquidityUsd = liquidity / 2;
                    const tokenBalance = priceUsd > 0 ? tokenLiquidityUsd / priceUsd : 0;

                    dexData.pools.push({
                        name: `ğŸŠ ${dexName} (${quoteSymbol} í˜ì–´)`,
                        address: pair.pairAddress,
                        liquidity: liquidity,
                        volume24h: volume,
                        balance: tokenBalance,
                        usdValue: tokenLiquidityUsd
                    });

                    // walletDataì— DEX í’€ ì¶”ê°€
                    walletData.push({
                        name: `ğŸŠ ${dexName} (${quoteSymbol} í˜ì–´)`,
                        address: pair.pairAddress,
                        balance: tokenBalance,
                        usdValue: tokenLiquidityUsd,
                        isMain: false,
                        withdrawal: null,
                        type: 'DEX'
                    });
                });

                // DEX ìœ ë™ì„±ì—ì„œ í† í° ì”ê³  ì¶”ì • (ìœ ë™ì„±ì˜ 50%ê°€ í•´ë‹¹ í† í°ì´ë¼ê³  ê°€ì •)
                dexData.totalUsd = totalLiquidity / 2;
                dexData.totalBalance = currentPrice > 0 ? dexData.totalUsd / currentPrice : 0;
                dexData.volume24h = totalVolume24h;

                // í…Œì´ë¸” ë‹¤ì‹œ ê·¸ë¦¬ê¸° (DEX í¬í•¨)
                updateWalletTable(true);

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('dexLoadingBox').style.display = 'none';
                document.getElementById('dexVolumeBox').style.display = 'block';
                document.getElementById('dexVolumeBox').innerHTML = `
                    ğŸ“Š DEX 24ì‹œê°„ ê±°ë˜ëŸ‰: <span style="color: var(--accent-green);">${formatUsdFull(totalVolume24h)}</span>
                    &nbsp;|&nbsp; ì´ ìœ ë™ì„±: <span style="color: var(--accent-blue);">${formatUsdFull(totalLiquidity)}</span>
                    &nbsp;|&nbsp; í’€ ${chainPairs.length}ê°œ
                `;

                // í†µê³„ ë‹¤ì‹œ ì—…ë°ì´íŠ¸
                const cexBalance = walletData.reduce((sum, w) => sum + w.balance, 0);
                const cexUsd = walletData.reduce((sum, w) => sum + w.usdValue, 0);
                updateStats(cexBalance, cexUsd);

            } catch (e) {
                console.error('DEX ì¡°íšŒ ì˜¤ë¥˜:', e);
                document.getElementById('dexLoadingBox').style.display = 'none';
                document.getElementById('dexVolumeBox').style.display = 'block';
                document.getElementById('dexVolumeBox').innerHTML = 'ğŸ“Š DEX ì¡°íšŒ ì‹¤íŒ¨: ' + e.message;
            }
        }

        // í° ìˆ«ì í¬ë§· (ì‰¼í‘œ í¬í•¨)
        function formatLargeNumber(num) {
            if (num === null || num === undefined || isNaN(num)) return '0';
            return num.toLocaleString('en-US', { maximumFractionDigits: 4 });
        }

        // USD ì „ì²´ í‘œì‹œ (ì‰¼í‘œ í¬í•¨)
        function formatUsdFull(num) {
            if (num === null || num === undefined || isNaN(num)) return '$0.00';
            return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ë³µì‚¬
        function copyContract() {
            const contractEl = document.getElementById('tokenContractCopy');
            const contract = currentToken;

            if (!contract || contract === '-') return;

            navigator.clipboard.writeText(contract).then(() => {
                contractEl.classList.add('copied');
                const originalText = contractEl.textContent;
                contractEl.textContent = 'ë³µì‚¬ë¨!';

                setTimeout(() => {
                    contractEl.classList.remove('copied');
                    contractEl.textContent = shortenAddress(contract);
                }, 1500);
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            });
        }

        // í† í° ì •ë³´ í—¤ë” ì—…ë°ì´íŠ¸
        function updateTokenInfoHeader(name, symbol, contract) {
            document.getElementById('tokenChainDisplay').textContent = `${CONFIG.chains[currentChain].name} (${currentChain})`;
            // íŒŒë¼ë¯¸í„° ê°’ì´ ì—†ê±°ë‚˜ Unknownì´ë©´ ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©
            const displayName = (name && name !== 'Unknown') ? name : (tokenName || '-');
            const displaySymbol = (symbol && symbol !== 'UNKNOWN') ? symbol : (tokenSymbol || '-');
            document.getElementById('tokenNameDisplay').textContent = displayName;
            document.getElementById('tokenSymbolDisplay').textContent = displaySymbol;
            document.getElementById('tokenContractCopy').textContent = shortenAddress(contract);

            // í…Œì´ë¸” í—¤ë”ì˜ í‹°ì»¤/ì»¨íŠ¸ë™íŠ¸ ë³µì‚¬ ì˜ì—­ ì—…ë°ì´íŠ¸
            const tickerDisplay = document.getElementById('tokenTickerDisplay');
            if (tickerDisplay) {
                tickerDisplay.classList.add('show');
                document.getElementById('tickerSymbol').textContent = displaySymbol;
                document.getElementById('tickerContract').textContent = shortenAddress(contract);
            }
        }

        // ===== ì •ë ¬ =====
        let currentSort = { field: 'usd', asc: false };

        function sortTable(field, forceDesc = false, keepCurrent = false) {
            // keepCurrent=true: í˜„ì¬ ì •ë ¬ ìƒíƒœ ìœ ì§€ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©)
            if (keepCurrent) {
                // ì•„ë¬´ê²ƒë„ ë³€ê²½í•˜ì§€ ì•ŠìŒ
            } else if (forceDesc) {
                // í—¤ë” í´ë¦­ ì‹œ í† ê¸€, ì´ˆê¸° í˜¸ì¶œ ì‹œ ê°•ì œ ë‚´ë¦¼ì°¨ìˆœ
                currentSort.field = field;
                currentSort.asc = false;
            } else if (currentSort.field === field) {
                currentSort.asc = !currentSort.asc;
            } else {
                currentSort.field = field;
                currentSort.asc = false;
            }

            const sortField = currentSort.field || 'usd';
            walletData.sort((a, b) => {
                let valA, valB;

                switch (sortField) {
                    case 'name':
                        valA = a.name;
                        valB = b.name;
                        break;
                    case 'balance':
                        valA = a.balance;
                        valB = b.balance;
                        break;
                    case 'usd':
                        valA = a.usdValue;
                        valB = b.usdValue;
                        break;
                    case 'withdrawal':
                        // ì¶œê¸ˆ ê¸ˆì•¡(ë‹¬ëŸ¬) ê¸°ì¤€
                        valA = (a.withdrawal?.amount || 0) * currentPrice;
                        valB = (b.withdrawal?.amount || 0) * currentPrice;
                        break;
                    case 'withdrawalTime':
                        valA = a.withdrawal?.timestamp || 0;
                        valB = b.withdrawal?.timestamp || 0;
                        break;
                    default:
                        return 0;
                }

                if (typeof valA === 'string') {
                    return currentSort.asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
                }
                return currentSort.asc ? valA - valB : valB - valA;
            });

            updateWalletTable();
        }

        // ===== ì‹¤ì‹œê°„ ê±°ë˜ì†Œ ê°€ê²© ì¡°íšŒ ì‹œìŠ¤í…œ (ì‹œì´ì¡°íšŒë´‡ ê¸°ë°˜) =====
        class RealtimePriceSystem {
            constructor() {
                this.websockets = new Map();
                this.lockedExchange = null; // í˜„ì¬ ê³ ì •ëœ ê±°ë˜ì†Œ
                this.lastPrice = 0;
                this.lastUpdateTime = 0;
                this.UPDATE_INTERVAL = 500; // 0.5ì´ˆ throttling (ë” ë¹ ë¥¸ ì—…ë°ì´íŠ¸)
                this.exchangePriority = {
                    'ë°”ì´ë‚¸ìŠ¤': 1,
                    'ë°”ì´ë¹—': 2,
                    'OKX': 3,
                    'Gate.io': 4
                };
                this.priceChangePercent = 0;
            }

            // ì›¹ì†Œì¼“ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
            startWebSocketStreams(symbol) {
                this.stopWebSocketStreams();
                this.lockedExchange = null;

                this.connectBinanceWebSocket(symbol);
                this.connectBybitWebSocket(symbol);
                this.connectOKXWebSocket(symbol);
                this.connectGateWebSocket(symbol);

                document.getElementById('wsStatus').className = 'status-dot';
                document.getElementById('wsStatusText').textContent = 'ì—°ê²° ì¤‘...';
            }

            // ë°”ì´ë‚¸ìŠ¤ ì›¹ì†Œì¼“
            connectBinanceWebSocket(symbol) {
                const wsSymbol = symbol.toLowerCase() + 'usdt';
                const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${wsSymbol}@ticker`);

                ws.onopen = () => {
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);

                    // ì—ëŸ¬ ë©”ì‹œì§€
                    if (data.e === 'error' || data.msg) {
                        console.error('[ë°”ì´ë‚¸ìŠ¤] ì—ëŸ¬:', data.msg || data.m);
                        return;
                    }

                    // ê°€ê²© ì—…ë°ì´íŠ¸
                    if (data.c) {
                        const price = parseFloat(data.c);
                        const change = parseFloat(data.P || 0);

                        if (!isNaN(price) && price > 0) {
                            this.updateRealtimePrice({
                                price: price,
                                change: change,
                                source: 'ë°”ì´ë‚¸ìŠ¤',
                                timestamp: Date.now()
                            });
                        }
                    }
                };

                ws.onclose = (event) => console.log('[ë°”ì´ë‚¸ìŠ¤] WebSocket ì—°ê²° ëŠê¹€, ì½”ë“œ:', event.code);
                ws.onerror = (error) => console.error('[ë°”ì´ë‚¸ìŠ¤] WebSocket ì˜¤ë¥˜:', error);

                this.websockets.set('binance', ws);
            }

            // ë°”ì´ë¹— ì›¹ì†Œì¼“
            connectBybitWebSocket(symbol) {
                const ws = new WebSocket('wss://stream.bybit.com/v5/public/spot');

                ws.onopen = () => {
                    const subscribeMsg = {
                        op: "subscribe",
                        args: [`tickers.${symbol.toUpperCase()}USDT`]
                    };
                    ws.send(JSON.stringify(subscribeMsg));
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);

                    // êµ¬ë… ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€
                    if (data.success !== undefined) {
                        return;
                    }

                    // ê°€ê²© ì—…ë°ì´íŠ¸
                    if (data.topic && data.topic.startsWith('tickers.') && data.data?.lastPrice) {
                        const price = parseFloat(data.data.lastPrice);
                        const change24h = parseFloat(data.data.price24hPcnt || 0) * 100;

                        if (!isNaN(price) && price > 0) {
                            this.updateRealtimePrice({
                                price: price,
                                change: change24h,
                                source: 'ë°”ì´ë¹—',
                                timestamp: Date.now()
                            });
                        }
                    }
                };

                ws.onclose = () => console.log('[ë°”ì´ë¹—] WebSocket ì—°ê²° ëŠê¹€');
                ws.onerror = (error) => console.error('[ë°”ì´ë¹—] WebSocket ì˜¤ë¥˜:', error);

                this.websockets.set('bybit', ws);
            }

            // OKX ì›¹ì†Œì¼“
            connectOKXWebSocket(symbol) {
                const ws = new WebSocket('wss://ws.okx.com:8443/ws/v5/public');

                ws.onopen = () => {
                    const subscribeMsg = {
                        "op": "subscribe",
                        "args": [{
                            "channel": "tickers",
                            "instId": `${symbol.toUpperCase()}-USDT`
                        }]
                    };
                    ws.send(JSON.stringify(subscribeMsg));
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);

                    // êµ¬ë… ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€
                    if (data.event === 'subscribe') {
                        return;
                    }
                    if (data.event === 'error') {
                        console.error('[OKX] ì—ëŸ¬:', data.msg);
                        return;
                    }

                    // ê°€ê²© ì—…ë°ì´íŠ¸
                    if (data.arg?.channel === 'tickers' && data.data?.[0]) {
                        const ticker = data.data[0];
                        const last = parseFloat(ticker.last);
                        const open24h = parseFloat(ticker.open24h || ticker.last);
                        const change = open24h > 0 ? ((last - open24h) / open24h) * 100 : 0;

                        if (!isNaN(last) && last > 0) {
                            this.updateRealtimePrice({
                                price: last,
                                change: change,
                                source: 'OKX',
                                timestamp: Date.now()
                            });
                        }
                    }
                };

                ws.onclose = () => console.log('[OKX] WebSocket ì—°ê²° ëŠê¹€');
                ws.onerror = (error) => console.error('[OKX] WebSocket ì˜¤ë¥˜:', error);

                this.websockets.set('okx', ws);
            }

            // Gate.io ì›¹ì†Œì¼“
            connectGateWebSocket(symbol) {
                const ws = new WebSocket('wss://api.gateio.ws/ws/v4/');

                ws.onopen = () => {
                    const subscribeMsg = {
                        "time": Math.floor(Date.now() / 1000),
                        "channel": "spot.tickers",
                        "event": "subscribe",
                        "payload": [`${symbol.toUpperCase()}_USDT`]
                    };
                    ws.send(JSON.stringify(subscribeMsg));
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);

                    // êµ¬ë… ì„±ê³µ ë©”ì‹œì§€ ë¬´ì‹œ
                    if (data.event === 'subscribe') {
                        return;
                    }

                    // ê°€ê²© ì—…ë°ì´íŠ¸ ë©”ì‹œì§€ ì²˜ë¦¬
                    if (data.channel === 'spot.tickers' && data.event === 'update' && data.result?.last) {
                        const price = parseFloat(data.result.last);
                        const change = parseFloat(data.result.change_percentage || 0);

                        if (!isNaN(price) && price > 0) {
                            this.updateRealtimePrice({
                                price: price,
                                change: change,
                                source: 'Gate.io',
                                timestamp: Date.now()
                            });
                        }
                    }
                };

                ws.onclose = () => console.log('[Gate.io] WebSocket ì—°ê²° ëŠê¹€');
                ws.onerror = (error) => console.error('[Gate.io] WebSocket ì˜¤ë¥˜:', error);

                this.websockets.set('gate', ws);
            }

            // ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ ì²˜ë¦¬ (ì‹œì´ì¡°íšŒë´‡ ë°©ì‹)
            updateRealtimePrice(priceData) {
                const currentPriority = this.exchangePriority[priceData.source] || 999;

                // ì´ë¯¸ ê³ ì •ëœ ê±°ë˜ì†Œê°€ ìˆìœ¼ë©´ ìš°ì„ ìˆœìœ„ ì²´í¬
                if (this.lockedExchange) {
                    const lockedPriority = this.exchangePriority[this.lockedExchange] || 999;

                    // ë” ë†’ì€ ìš°ì„ ìˆœìœ„ ê±°ë˜ì†Œê°€ ì˜¤ë©´ êµì²´
                    if (currentPriority < lockedPriority) {
                        this.lockedExchange = priceData.source;
                    } else if (priceData.source !== this.lockedExchange) {
                        return; // ë‚®ì€ ìš°ì„ ìˆœìœ„ëŠ” ë¬´ì‹œ
                    }
                } else {
                    // ì²˜ìŒ ë“¤ì–´ì˜¨ ê±°ë˜ì†Œë¥¼ ê³ ì •
                    this.lockedExchange = priceData.source;
                }

                // ê°€ê²© ë³€ë™ ê°ì§€ (ê¹œë¹¡ì„ íš¨ê³¼ìš©)
                const oldPrice = this.lastPrice;
                this.lastPrice = priceData.price;
                this.priceChangePercent = priceData.change;

                // ì „ì—­ ê°€ê²© ì—…ë°ì´íŠ¸
                currentPrice = priceData.price;

                // UI ì—…ë°ì´íŠ¸ (throttling ì—†ì´ ë°”ë¡œ)
                this.updateUI(priceData, oldPrice);
            }

            // UI ì—…ë°ì´íŠ¸
            updateUI(priceData, oldPrice) {

                // ê°€ê²© í‘œì‹œ
                const priceEl = document.getElementById('currentPrice');
                if (!priceEl) {
                    console.error('[updateUI] currentPrice ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
                    return;
                }

                const newText = priceData.price < 1
                    ? `$${priceData.price.toFixed(6)}`
                    : `$${priceData.price.toFixed(4)}`;

                priceEl.textContent = newText;

                // ê°€ê²© ë³€ë™ ì‹œ ê¹œë¹¡ì„ íš¨ê³¼
                if (oldPrice > 0 && oldPrice !== priceData.price) {
                    const isUp = priceData.price > oldPrice;
                    priceEl.style.transition = 'none';
                    priceEl.style.color = isUp ? 'var(--accent-green)' : 'var(--accent-red)';
                    priceEl.style.textShadow = isUp
                        ? '0 0 10px rgba(63, 185, 80, 0.5)'
                        : '0 0 10px rgba(248, 81, 73, 0.5)';

                    setTimeout(() => {
                        priceEl.style.transition = 'color 0.5s, text-shadow 0.5s';
                        priceEl.style.color = 'var(--text-primary)';
                        priceEl.style.textShadow = 'none';
                    }, 300);
                }

                // ë³€ë™ë¥  í‘œì‹œ
                const changeEl = document.getElementById('priceChange');
                changeEl.textContent = `${priceData.change >= 0 ? '+' : ''}${priceData.change.toFixed(2)}%`;
                changeEl.className = `market-change ${priceData.change >= 0 ? 'positive' : 'negative'}`;

                // ì‹¤ì‹œê°„ ì‹œì´ ê³„ì‚°
                if (circulatingSupply > 0) {
                    document.getElementById('marketCap').textContent = formatUsd(currentPrice * circulatingSupply);
                }

                // ê±°ë˜ì†Œ ì†ŒìŠ¤ í‘œì‹œ
                document.getElementById('priceSource').innerHTML = `
                    <span class="status-dot"></span>
                    <span>${priceData.source} LIVE</span>
                `;

                // ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('wsStatus').className = 'status-dot';
                document.getElementById('wsStatusText').textContent = `${priceData.source} ì—°ê²°`;

                // ë¯¸ë‹ˆ ê°€ê²© í‘œì‹œë„ ì—…ë°ì´íŠ¸ (WebSocket ì¶œì²˜)
                updateMiniPrice(tokenSymbol, newText, priceData.change, priceData.source);

                // ì§€ê°‘ USD ê°€ì¹˜ ì—…ë°ì´íŠ¸
                walletData.forEach(w => {
                    w.usdValue = w.balance * currentPrice;
                });

                // í˜„ì¬ ì •ë ¬ ìƒíƒœ ìœ ì§€í•˜ë©´ì„œ í…Œì´ë¸” ì¬ì •ë ¬
                sortTable(null, false, true);
            }

            // ì›¹ì†Œì¼“ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
            stopWebSocketStreams() {
                this.websockets.forEach((ws, name) => {
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.close();
                    }
                });
                this.websockets.clear();
                this.lockedExchange = null;
            }
        }

        // ì „ì—­ ê°€ê²© ì‹œìŠ¤í…œ ì¸ìŠ¤í„´ìŠ¤
        const realtimePriceSystem = new RealtimePriceSystem();

        // ë ˆê±°ì‹œ í•¨ìˆ˜ (í˜¸í™˜ì„±)
        function startPriceStream(symbol) {
            realtimePriceSystem.startWebSocketStreams(symbol);
        }

        function stopPriceStream() {
            realtimePriceSystem.stopWebSocketStreams();
        }

        // ===== ìë™ ê°±ì‹  =====
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const toggle = document.getElementById('autoRefreshToggle');
            toggle.classList.toggle('active', autoRefreshEnabled);

            if (autoRefreshEnabled && currentToken) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        }

        function startAutoRefresh() {
            stopAutoRefresh();
            if (autoRefreshEnabled) {
                refreshTimer = setInterval(refreshData, CONFIG.refreshInterval);
            }
        }

        function stopAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
                refreshTimer = null;
            }
        }

        // ===== ë°ì´í„° ìƒˆë¡œê³ ì¹¨ =====
        async function refreshData() {
            if (!currentToken) return;

            const btn = document.getElementById('refreshBtn');
            btn.classList.add('spinning');

            try {
                // ì”ê³  ë¨¼ì € ê°±ì‹  (ì¶œê¸ˆ ë‚´ì—­ì€ ìºì‹œ ì‚¬ìš©)
                await fetchAllWalletData(true);

                // ì¶œê¸ˆ ë‚´ì—­ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°íšŒ (ë³€ê²½ ì‹œì—ë§Œ ì—…ë°ì´íŠ¸)
                if (!isWithdrawalFetching) {
                    const wallets = CONFIG.chains[currentChain].wallets;
                    const walletEntries = Object.entries(wallets);
                    // ë°±ê·¸ë¼ìš´ë“œ ì¡°íšŒ ì‹œì‘ (await ì•ˆí•¨ - ë¹„ë™ê¸°ë¡œ)
                    fetchWithdrawalsInBackground(walletEntries, walletEntries.length, true);
                }
            } catch (e) {
                console.error('Refresh error:', e);
            } finally {
                btn.classList.remove('spinning');
            }
        }

        // ===== ë©”ì¸ ê²€ìƒ‰ í•¨ìˆ˜ =====
        // í† í° ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (CoinGecko API)
        async function searchTokenByName(query) {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/search?query=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error('CoinGecko ê²€ìƒ‰ ì‹¤íŒ¨');

                const data = await response.json();
                const coins = data.coins || [];

                // í˜„ì¬ ì„ íƒëœ ì²´ì¸ì— ë§ëŠ” í”Œë«í¼ ë§¤í•‘
                const chainToPlatform = {
                    'ETH': 'ethereum',
                    'BSC': 'binance-smart-chain',
                    'ARB': 'arbitrum-one',
                    'OP': 'optimism',
                    'BASE': 'base',
                    'AVAX': 'avalanche',
                    'POL': 'polygon-pos'
                };

                const platform = chainToPlatform[currentChain];

                // í•´ë‹¹ ì²´ì¸ì— ì»¨íŠ¸ë™íŠ¸ê°€ ìˆëŠ” ì½”ì¸ë§Œ í•„í„°ë§í•˜ë ¤ë©´ ìƒì„¸ ì¡°íšŒ í•„ìš”
                // ì¼ë‹¨ ìƒìœ„ 10ê°œ ê²°ê³¼ ë°˜í™˜
                return coins.slice(0, 10);
            } catch (e) {
                console.error('í† í° ê²€ìƒ‰ ì˜¤ë¥˜:', e);
                return [];
            }
        }

        // ì½”ì¸ ìƒì„¸ ì •ë³´ì—ì„œ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
        async function getContractAddress(coinId, chain) {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}`);
                if (!response.ok) {
                    console.error('CoinGecko API ì‘ë‹µ ì‹¤íŒ¨:', response.status);
                    return null;
                }

                const data = await response.json();
                const platforms = data.platforms || {};

                const chainToPlatform = {
                    'ETH': 'ethereum',
                    'BSC': 'binance-smart-chain',
                    'ARB': 'arbitrum-one',
                    'OP': 'optimism',
                    'BASE': 'base',
                    'AVAX': 'avalanche',
                    'POL': 'polygon-pos'
                };

                const platform = chainToPlatform[chain];
                return platforms[platform] || null;
            } catch (e) {
                console.error('ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ì¡°íšŒ ì˜¤ë¥˜:', e);
                return null;
            }
        }

        // í† í° ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showTokenSelectModal(tokens) {
            const modal = document.getElementById('tokenSelectModal');
            const list = document.getElementById('tokenSelectList');
            modal.style.display = 'flex';

            // ê±°ë˜ì†Œ ì •ë³´ ì¡°íšŒ ì œê±° (API ë ˆì´íŠ¸ ë¦¬ë°‹ ë°©ì§€)
            // ì‹œì´ ìˆœìœ„ë¡œ êµ¬ë¶„ ê°€ëŠ¥
            list.innerHTML = tokens.map((token, index) => `
                <div class="token-select-item" onclick="selectToken('${token.id}', '${token.symbol}', '${token.name.replace(/'/g, "\\'")}')">
                    <img src="${token.thumb}" alt="${token.symbol}" onerror="this.style.display='none'" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 12px;">
                    <div style="flex: 1; min-width: 0;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-weight: 600;">${token.symbol.toUpperCase()}</span>
                            ${token.market_cap_rank
                                ? `<span style="font-size: 0.75rem; color: var(--accent-blue);">ì‹œì´ #${token.market_cap_rank}</span>`
                                : '<span style="font-size: 0.75rem; color: var(--text-muted);">ìˆœìœ„ ì—†ìŒ</span>'}
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${token.name}</div>
                    </div>
                </div>
            `).join('');
        }

        // í† í° ì„ íƒ
        async function selectToken(coinId, symbol, name) {
            document.getElementById('tokenSelectModal').style.display = 'none';
            showLoading(`${symbol} ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ì¡°íšŒ ì¤‘...`);

            // í˜„ì¬ ì„ íƒëœ ì²´ì¸ ê°€ì ¸ì˜¤ê¸° (ë“œë¡­ë‹¤ìš´ì—ì„œ ì§ì ‘)
            const selectedChain = document.getElementById('chainSelect').value;

            const contractAddress = await getContractAddress(coinId, selectedChain);

            if (contractAddress) {
                // í† í° ì •ë³´ ì €ì¥ (CoinGecko ë ˆì´íŠ¸ ë¦¬ë°‹ ëŒ€ë¹„)
                tokenSymbol = symbol.toUpperCase();
                tokenName = name;
                currentCoinGeckoId = coinId;  // markets APIìš© ID ì €ì¥

                document.getElementById('tokenAddress').value = contractAddress;
                hideLoading();
                startSearch();
            } else {
                hideLoading();
                alert(`${name}ì€(ëŠ”) ${selectedChain} ì²´ì¸ì— ì»¨íŠ¸ë™íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì²´ì¸ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.`);
            }
        }

        // í† í° ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
        function closeTokenSelectModal() {
            document.getElementById('tokenSelectModal').style.display = 'none';
        }

        async function startSearch() {
            currentChain = document.getElementById('chainSelect').value;
            currentToken = document.getElementById('tokenAddress').value.trim();

            // 0xë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ í† í° ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰
            if (currentToken && !currentToken.startsWith('0x')) {
                showLoading(`"${currentToken}" ê²€ìƒ‰ ì¤‘...`);
                const tokens = await searchTokenByName(currentToken);
                hideLoading();

                if (tokens.length === 0) {
                    alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. í† í° ì´ë¦„ì´ë‚˜ ì‹¬ë³¼ì„ í™•ì¸í•˜ì„¸ìš”.');
                    return;
                } else if (tokens.length === 1) {
                    // ê²°ê³¼ê°€ 1ê°œë©´ ë°”ë¡œ ì„ íƒ
                    await selectToken(tokens[0].id, tokens[0].symbol, tokens[0].name);
                    return;
                } else {
                    // ì—¬ëŸ¬ ê°œë©´ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
                    showTokenSelectModal(tokens);
                    return;
                }
            }

            if (!currentToken || !currentToken.startsWith('0x')) {
                alert('í† í° ì´ë¦„ ë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            // ì§ì ‘ ì£¼ì†Œ ì…ë ¥ ì‹œ coinId ì´ˆê¸°í™” (contract APIì—ì„œ ìë™ ê°ì§€ë¨)
            currentCoinGeckoId = '';

            showLoading('í† í° ì •ë³´ ì¡°íšŒ ì¤‘...');
            updateProgress(0, '', true);  // ìƒˆ ì¡°íšŒ ì‹œì‘ ì‹œ ë¦¬ì…‹

            // ìƒˆ ê²€ìƒ‰ ì‹œ ìºì‹œ ë° ë°ì´í„° ì´ˆê¸°í™”
            withdrawalCache.clear();
            walletData = [];  // DEX ë°ì´í„° í¬í•¨ ì „ì²´ ì´ˆê¸°í™”

            try {
                // 1. í† í° ì •ë³´ ì¡°íšŒ
                const tokenInfo = await getTokenInfo(currentChain, currentToken);
                tokenDecimals = tokenInfo.decimals;
                tokenSymbol = tokenInfo.symbol;

                // í† í° ì •ë³´ í—¤ë” ì—…ë°ì´íŠ¸
                updateTokenInfoHeader(tokenInfo.name || tokenSymbol, tokenSymbol, currentToken);

                updateProgress(20);
                document.getElementById('loadingText').textContent = 'ì‹œì¥ ë°ì´í„° ì¡°íšŒ ì¤‘...';

                // 2. ì‹œì¥ ë°ì´í„° ì¡°íšŒ
                const marketData = await getMarketData(currentChain, currentToken);
                updateMarketUI(marketData);

                updateProgress(30);
                document.getElementById('loadingText').textContent = 'ì§€ê°‘ ì”ê³  + DEX ì¡°íšŒ ì¤‘...';

                // 3. ì§€ê°‘ ë°ì´í„° + DEX ë³‘ë ¬ ì¡°íšŒ
                const includeDex = document.getElementById('includeDex').checked;

                // DEX ì¡°íšŒ Promise (ì²´í¬ ì‹œì—ë§Œ)
                const dexPromise = includeDex ? fetchDexLiquidityData() : Promise.resolve(null);

                // ì”ê³  ì¡°íšŒ (ì¶œê¸ˆ ë‚´ì—­ ì œì™¸ - ë‚˜ì¤‘ì— ë°±ê·¸ë¼ìš´ë“œ)
                await fetchAllWalletData(false, true);  // skipWithdrawal=false, skipSort=true

                // DEX ë°ì´í„° ëŒ€ê¸° ë° ì¶”ê°€
                if (includeDex) {
                    const dexPools = await dexPromise;
                    if (dexPools && dexPools.length > 0) {
                        // DEX í’€ì„ walletDataì— ì¶”ê°€
                        dexPools.forEach(pool => walletData.push(pool));
                    }
                } else {
                    document.getElementById('dexLoadingBox').style.display = 'none';
                    document.getElementById('dexVolumeBox').style.display = 'none';
                }

                // 4. CEX + DEX í•œ ë²ˆì— ì •ë ¬ í›„ í…Œì´ë¸” í‘œì‹œ
                sortTable('usd', true);
                hideLoading();

                // 5. UI í‘œì‹œ
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';

                // 6. WebSocket ê°€ê²© ìŠ¤íŠ¸ë¦¼ ì‹œì‘
                if (tokenSymbol && tokenSymbol !== 'UNKNOWN') {
                    startPriceStream(tokenSymbol);
                } else {
                    console.warn('[WebSocket] í† í° ì‹¬ë³¼ì„ ì•Œ ìˆ˜ ì—†ì–´ ì‹¤ì‹œê°„ ê°€ê²© ìŠ¤íŠ¸ë¦¼ ì‹œì‘ ë¶ˆê°€');
                    document.getElementById('wsStatus').className = 'status-dot offline';
                    document.getElementById('wsStatusText').textContent = 'ì‹¬ë³¼ ì—†ìŒ';
                }

                // 7. ìë™ ê°±ì‹  ì‹œì‘
                startAutoRefresh();

            } catch (e) {
                console.error('Search error:', e);
                alert('ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
            } finally {
                hideLoading();
            }
        }

        // ===== ì´ˆê¸°í™” =====
        document.addEventListener('DOMContentLoaded', () => {
            // Enter í‚¤ë¡œ ê²€ìƒ‰
            document.getElementById('tokenAddress').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    startSearch();
                }
            });
        });
    </script>
</body>
</html>



